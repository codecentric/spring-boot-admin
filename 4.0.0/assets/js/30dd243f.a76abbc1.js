"use strict";(self.webpackChunksite=self.webpackChunksite||[]).push([[1887],{9695:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>t,default:()=>p,frontMatter:()=>a,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"integration/zookeeper","title":"Zookeeper Integration","description":"Apache Zookeeper is a centralized coordination service that can be used for service discovery with Spring Cloud","source":"@site/docs/04-integration/30-zookeeper.md","sourceDirName":"04-integration","slug":"/integration/zookeeper","permalink":"/4.0.0/docs/integration/zookeeper","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":30,"frontMatter":{"sidebar_position":30,"sidebar_custom_props":{"icon":"cloud"}},"sidebar":"sidebar","previous":{"title":"Consul Integration","permalink":"/4.0.0/docs/integration/consul"},"next":{"title":"Hazelcast Clustering","permalink":"/4.0.0/docs/integration/hazelcast"}}');var o=i(4848),s=i(8453);const a={sidebar_position:30,sidebar_custom_props:{icon:"cloud"}},t="Zookeeper Integration",l={},c=[{value:"Overview",id:"overview",level:2},{value:"Setting Up Zookeeper",id:"setting-up-zookeeper",level:2},{value:"Install Zookeeper",id:"install-zookeeper",level:3},{value:"Start Zookeeper",id:"start-zookeeper",level:3},{value:"Configuring Spring Boot Admin Server",id:"configuring-spring-boot-admin-server",level:2},{value:"Add Dependencies",id:"add-dependencies",level:3},{value:"Enable Discovery",id:"enable-discovery",level:3},{value:"Configure Zookeeper Client",id:"configure-zookeeper-client",level:3},{value:"Configuring Client Applications",id:"configuring-client-applications",level:2},{value:"Add Dependencies",id:"add-dependencies-1",level:3},{value:"Enable Discovery",id:"enable-discovery-1",level:3},{value:"Configure Application",id:"configure-application",level:3},{value:"Metadata Configuration",id:"metadata-configuration",level:2},{value:"Adding Custom Metadata",id:"adding-custom-metadata",level:3},{value:"Management Port",id:"management-port",level:3},{value:"Instance Configuration",id:"instance-configuration",level:2},{value:"Instance ID",id:"instance-id",level:3},{value:"Prefer IP Address",id:"prefer-ip-address",level:3},{value:"Custom Service Name",id:"custom-service-name",level:3},{value:"Connection Configuration",id:"connection-configuration",level:2},{value:"Connection Timeout",id:"connection-timeout",level:3},{value:"Multiple Zookeeper Servers",id:"multiple-zookeeper-servers",level:3},{value:"Zookeeper Path",id:"zookeeper-path",level:3},{value:"Docker Compose Example",id:"docker-compose-example",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Connection Failures",id:"connection-failures",level:3},{value:"Service Not Appearing",id:"service-not-appearing",level:3},{value:"Session Timeout",id:"session-timeout",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"Complete Example",id:"complete-example",level:2},{value:"See Also",id:"see-also",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"zookeeper-integration",children:"Zookeeper Integration"})}),"\n",(0,o.jsx)(n.p,{children:"Apache Zookeeper is a centralized coordination service that can be used for service discovery with Spring Cloud\nZookeeper. This guide shows how to integrate Spring Boot Admin with Zookeeper."}),"\n",(0,o.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,o.jsx)(n.p,{children:"With Zookeeper integration:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Applications register with Zookeeper"}),"\n",(0,o.jsx)(n.li,{children:"Spring Boot Admin Server discovers applications via Zookeeper"}),"\n",(0,o.jsx)(n.li,{children:"Automatic ephemeral node management"}),"\n",(0,o.jsx)(n.li,{children:"No Spring Boot Admin Client library required"}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"setting-up-zookeeper",children:"Setting Up Zookeeper"}),"\n",(0,o.jsx)(n.h3,{id:"install-zookeeper",children:"Install Zookeeper"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# macOS\nbrew install zookeeper\n\n# Linux\nwget https://downloads.apache.org/zookeeper/zookeeper-3.8.3/apache-zookeeper-3.8.3-bin.tar.gz\ntar -xzf apache-zookeeper-3.8.3-bin.tar.gz\ncd apache-zookeeper-3.8.3-bin\n\n# Docker\ndocker run -d --name zookeeper -p 2181:2181 zookeeper:latest\n"})}),"\n",(0,o.jsx)(n.h3,{id:"start-zookeeper",children:"Start Zookeeper"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# Direct\nzkServer start\n\n# Docker\ndocker start zookeeper\n"})}),"\n",(0,o.jsx)(n.p,{children:"Verify Zookeeper is running:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"echo ruok | nc localhost 2181\n# Should respond with: imok\n"})}),"\n",(0,o.jsx)(n.h2,{id:"configuring-spring-boot-admin-server",children:"Configuring Spring Boot Admin Server"}),"\n",(0,o.jsx)(n.h3,{id:"add-dependencies",children:"Add Dependencies"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-xml",metastring:'title="pom.xml"',children:"<dependencies>\n    <dependency>\n        <groupId>de.codecentric</groupId>\n        <artifactId>spring-boot-admin-starter-server</artifactId>\n    </dependency>\n    <dependency>\n        <groupId>org.springframework.boot</groupId>\n        <artifactId>spring-boot-starter-webflux</artifactId>\n    </dependency>\n    <dependency>\n        <groupId>org.springframework.cloud</groupId>\n        <artifactId>spring-cloud-starter-zookeeper-discovery</artifactId>\n    </dependency>\n</dependencies>\n"})}),"\n",(0,o.jsx)(n.h3,{id:"enable-discovery",children:"Enable Discovery"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-java",metastring:'title="SpringBootAdminZookeeperApplication.java"',children:"import de.codecentric.boot.admin.server.config.EnableAdminServer;\nimport org.springframework.boot.SpringApplication;\nimport org.springframework.boot.autoconfigure.SpringBootApplication;\nimport org.springframework.cloud.client.discovery.EnableDiscoveryClient;\n\n@EnableDiscoveryClient\n@EnableAdminServer\n@SpringBootApplication\npublic class SpringBootAdminZookeeperApplication {\n    public static void main(String[] args) {\n        SpringApplication.run(SpringBootAdminZookeeperApplication.class, args);\n    }\n}\n"})}),"\n",(0,o.jsx)(n.h3,{id:"configure-zookeeper-client",children:"Configure Zookeeper Client"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",metastring:'title="application.yml"',children:'spring:\n  application:\n    name: spring-boot-admin-server\n  cloud:\n    zookeeper:\n      connect-string: localhost:2181\n      discovery:\n        enabled: true\n        register: true\n        root: /services\n\nmanagement:\n  endpoints:\n    web:\n      exposure:\n        include: "*"\n  endpoint:\n    health:\n      show-details: ALWAYS\n'})}),"\n",(0,o.jsx)(n.h2,{id:"configuring-client-applications",children:"Configuring Client Applications"}),"\n",(0,o.jsx)(n.h3,{id:"add-dependencies-1",children:"Add Dependencies"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-xml",metastring:'title="pom.xml"',children:"<dependency>\n    <groupId>org.springframework.cloud</groupId>\n    <artifactId>spring-cloud-starter-zookeeper-discovery</artifactId>\n</dependency>\n"})}),"\n",(0,o.jsx)(n.h3,{id:"enable-discovery-1",children:"Enable Discovery"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-java",children:"@EnableDiscoveryClient\n@SpringBootApplication\npublic class Application {\n    public static void main(String[] args) {\n        SpringApplication.run(Application.class, args);\n    }\n}\n"})}),"\n",(0,o.jsx)(n.h3,{id:"configure-application",children:"Configure Application"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",metastring:'title="application.yml"',children:'spring:\n  application:\n    name: my-application\n  cloud:\n    zookeeper:\n      connect-string: localhost:2181\n      discovery:\n        enabled: true\n        register: true\n        metadata:\n          management.context-path: /actuator\n          user.name: ${spring.security.user.name}\n          user.password: ${spring.security.user.password}\n\nmanagement:\n  endpoints:\n    web:\n      exposure:\n        include: "*"\n  endpoint:\n    health:\n      show-details: ALWAYS\n'})}),"\n",(0,o.jsx)(n.h2,{id:"metadata-configuration",children:"Metadata Configuration"}),"\n",(0,o.jsx)(n.h3,{id:"adding-custom-metadata",children:"Adding Custom Metadata"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",metastring:'title="application.yml"',children:"spring:\n  cloud:\n    zookeeper:\n      discovery:\n        metadata:\n          management.context-path: /actuator\n          user.name: admin\n          user.password: secret\n          tags.environment: production\n          tags.region: us-east-1\n          team: platform\n          version: 1.0.0\n"})}),"\n",(0,o.jsx)(n.h3,{id:"management-port",children:"Management Port"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",metastring:'title="application.yml"',children:"server:\n  port: 8080\n\nmanagement:\n  server:\n    port: 9090\n  endpoints:\n    web:\n      base-path: /actuator\n\nspring:\n  cloud:\n    zookeeper:\n      discovery:\n        metadata:\n          management.port: 9090\n          management.context-path: /actuator\n"})}),"\n",(0,o.jsx)(n.h2,{id:"instance-configuration",children:"Instance Configuration"}),"\n",(0,o.jsx)(n.h3,{id:"instance-id",children:"Instance ID"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:"spring:\n  cloud:\n    zookeeper:\n      discovery:\n        instance-id: ${spring.application.name}:${random.value}\n"})}),"\n",(0,o.jsx)(n.h3,{id:"prefer-ip-address",children:"Prefer IP Address"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:"spring:\n  cloud:\n    zookeeper:\n      discovery:\n        preferIpAddress: true\n"})}),"\n",(0,o.jsx)(n.h3,{id:"custom-service-name",children:"Custom Service Name"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:"spring:\n  cloud:\n    zookeeper:\n      discovery:\n        serviceName: custom-service-name\n"})}),"\n",(0,o.jsx)(n.h2,{id:"connection-configuration",children:"Connection Configuration"}),"\n",(0,o.jsx)(n.h3,{id:"connection-timeout",children:"Connection Timeout"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:"spring:\n  cloud:\n    zookeeper:\n      connect-string: localhost:2181\n      max-retries: 10\n      max-sleep-ms: 500\n      connection-timeout: 15000\n      session-timeout: 60000\n"})}),"\n",(0,o.jsx)(n.h3,{id:"multiple-zookeeper-servers",children:"Multiple Zookeeper Servers"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:"spring:\n  cloud:\n    zookeeper:\n      connect-string: zk1:2181,zk2:2181,zk3:2181\n"})}),"\n",(0,o.jsx)(n.h3,{id:"zookeeper-path",children:"Zookeeper Path"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:"spring:\n  cloud:\n    zookeeper:\n      discovery:\n        root: /services\n        uriSpec: '{scheme}://{address}:{port}'\n"})}),"\n",(0,o.jsx)(n.h2,{id:"docker-compose-example",children:"Docker Compose Example"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",metastring:'title="docker-compose.yml"',children:'version: \'3\'\n\nservices:\n  zookeeper:\n    image: zookeeper:3.8\n    ports:\n      - "2181:2181"\n    environment:\n      - ZOO_MY_ID=1\n\n  spring-boot-admin:\n    build: ./admin-server\n    ports:\n      - "8080:8080"\n    environment:\n      - SPRING_CLOUD_ZOOKEEPER_CONNECT_STRING=zookeeper:2181\n    depends_on:\n      - zookeeper\n\n  my-application:\n    build: ./my-app\n    ports:\n      - "8081:8081"\n    environment:\n      - SPRING_CLOUD_ZOOKEEPER_CONNECT_STRING=zookeeper:2181\n    depends_on:\n      - zookeeper\n'})}),"\n",(0,o.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,o.jsx)(n.h3,{id:"connection-failures",children:"Connection Failures"}),"\n",(0,o.jsx)(n.p,{children:"Check Zookeeper is running:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"echo ruok | nc localhost 2181\n"})}),"\n",(0,o.jsx)(n.p,{children:"Verify connection:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"zkCli.sh -server localhost:2181\nls /services\n"})}),"\n",(0,o.jsx)(n.h3,{id:"service-not-appearing",children:"Service Not Appearing"}),"\n",(0,o.jsx)(n.p,{children:"List registered services:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"zkCli.sh -server localhost:2181\nls /services\nget /services/my-application\n"})}),"\n",(0,o.jsx)(n.h3,{id:"session-timeout",children:"Session Timeout"}),"\n",(0,o.jsx)(n.p,{children:"Increase session timeout:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:"spring:\n  cloud:\n    zookeeper:\n      session-timeout: 120000  # 2 minutes\n"})}),"\n",(0,o.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Configure Retries"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:"spring:\n  cloud:\n    zookeeper:\n      max-retries: 10\n      max-sleep-ms: 500\n"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Use Ensemble"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:"spring:\n  cloud:\n    zookeeper:\n      connect-string: zk1:2181,zk2:2181,zk3:2181\n"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Set Appropriate Timeouts"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:"spring:\n  cloud:\n    zookeeper:\n      connection-timeout: 15000\n      session-timeout: 60000\n"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Use Instance IDs"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:"spring:\n  cloud:\n    zookeeper:\n      discovery:\n        instance-id: ${spring.application.name}:${random.value}\n"})}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Monitor Zookeeper Health"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"echo mntr | nc localhost 2181\n"})}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"complete-example",children:"Complete Example"}),"\n",(0,o.jsxs)(n.p,{children:["See\nthe ",(0,o.jsx)(n.a,{href:"https://github.com/codecentric/spring-boot-admin/tree/master/spring-boot-admin-samples/spring-boot-admin-sample-zookeeper/",children:"spring-boot-admin-sample-zookeeper"}),"\nproject for a complete working example."]}),"\n",(0,o.jsx)(n.h2,{id:"see-also",children:"See Also"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.a,{href:"/4.0.0/docs/client/service-discovery",children:"Service Discovery"})," - Service discovery overview"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.a,{href:"/4.0.0/docs/samples/sample-zookeeper",children:"Zookeeper Sample"})," - Detailed sample walkthrough"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.a,{href:"/4.0.0/docs/client/metadata",children:"Metadata"})," - Working with metadata"]}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>a,x:()=>t});var r=i(6540);const o={},s=r.createContext(o);function a(e){const n=r.useContext(s);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:a(e.components),r.createElement(s.Provider,{value:n},e.children)}}}]);