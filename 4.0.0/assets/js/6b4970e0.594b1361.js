"use strict";(self.webpackChunksite=self.webpackChunksite||[]).push([[2792],{6108:(n,e,t)=>{t.r(e),t.d(e,{assets:()=>d,contentTitle:()=>a,default:()=>p,frontMatter:()=>s,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"customization/server/endpoint-detection","title":"Custom Endpoint Detection","description":"Customize how Spring Boot Admin Server discovers actuator endpoints from registered instances.","source":"@site/docs/06-customization/server/04-endpoint-detection.md","sourceDirName":"06-customization/server","slug":"/customization/server/endpoint-detection","permalink":"/4.0.0/docs/customization/server/endpoint-detection","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4,"sidebar_custom_props":{"icon":"wrench"}},"sidebar":"sidebar","previous":{"title":"Custom Health Status","permalink":"/4.0.0/docs/customization/monitoring/custom-health-status"},"next":{"title":"Third Party Integrations","permalink":"/4.0.0/docs/third-party/"}}');var r=t(4848),o=t(8453);const s={sidebar_position:4,sidebar_custom_props:{icon:"wrench"}},a="Custom Endpoint Detection",d={},c=[{value:"Overview",id:"overview",level:2},{value:"Default Behavior",id:"default-behavior",level:2},{value:"QueryIndexEndpointStrategy",id:"queryindexendpointstrategy",level:2},{value:"How It Works",id:"how-it-works",level:3},{value:"Use Only QueryIndexEndpointStrategy",id:"use-only-queryindexendpointstrategy",level:3},{value:"ProbeEndpointsStrategy",id:"probeendpointsstrategy",level:2},{value:"How It Works",id:"how-it-works-1",level:3},{value:"Configuration",id:"configuration",level:3},{value:"Custom Endpoint Paths",id:"custom-endpoint-paths",level:3},{value:"Use Only ProbeEndpointsStrategy",id:"use-only-probeendpointsstrategy",level:3},{value:"ChainingStrategy",id:"chainingstrategy",level:2},{value:"How It Works",id:"how-it-works-2",level:3},{value:"Custom Chaining",id:"custom-chaining",level:3},{value:"Custom EndpointDetectionStrategy",id:"custom-endpointdetectionstrategy",level:2},{value:"Interface",id:"interface",level:3},{value:"Example: Static Endpoint Strategy",id:"example-static-endpoint-strategy",level:3},{value:"Example: Service-Specific Endpoints",id:"example-service-specific-endpoints",level:3},{value:"Example: Database-Driven Endpoints",id:"example-database-driven-endpoints",level:3},{value:"Example: HTTP-Based Discovery",id:"example-http-based-discovery",level:3},{value:"Endpoint Detection Lifecycle",id:"endpoint-detection-lifecycle",level:2},{value:"When Detection Occurs",id:"when-detection-occurs",level:3},{value:"Trigger Manual Detection",id:"trigger-manual-detection",level:3},{value:"Debugging Endpoint Detection",id:"debugging-endpoint-detection",level:2},{value:"Enable Debug Logging",id:"enable-debug-logging",level:3},{value:"Check Detected Endpoints",id:"check-detected-endpoints",level:3},{value:"Advanced Scenarios",id:"advanced-scenarios",level:2},{value:"Scenario 1: Legacy Spring Boot 1.x Support",id:"scenario-1-legacy-spring-boot-1x-support",level:3},{value:"Scenario 2: Mixed Spring Boot Versions",id:"scenario-2-mixed-spring-boot-versions",level:3},{value:"Scenario 3: Custom Actuator Path",id:"scenario-3-custom-actuator-path",level:3},{value:"Scenario 4: Conditional Detection Based on Metadata",id:"scenario-4-conditional-detection-based-on-metadata",level:3},{value:"Performance Considerations",id:"performance-considerations",level:2},{value:"QueryIndexEndpointStrategy",id:"queryindexendpointstrategy-1",level:3},{value:"ProbeEndpointsStrategy",id:"probeendpointsstrategy-1",level:3},{value:"Optimization",id:"optimization",level:3},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Issue: No endpoints detected",id:"issue-no-endpoints-detected",level:3},{value:"Issue: Wrong endpoints detected",id:"issue-wrong-endpoints-detected",level:3},{value:"Issue: Custom endpoints not detected",id:"issue-custom-endpoints-not-detected",level:3},{value:"See Also",id:"see-also",level:2},{value:"Complete Example",id:"complete-example",level:2}];function l(n){const e={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...n.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.header,{children:(0,r.jsx)(e.h1,{id:"custom-endpoint-detection",children:"Custom Endpoint Detection"})}),"\n",(0,r.jsx)(e.p,{children:"Customize how Spring Boot Admin Server discovers actuator endpoints from registered instances."}),"\n",(0,r.jsx)(e.h2,{id:"overview",children:"Overview"}),"\n",(0,r.jsx)(e.p,{children:"When a client registers, the Admin Server detects available actuator endpoints. This detection uses strategies that can\nbe customized:"}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"QueryIndexEndpointStrategy"})," (default) - Queries ",(0,r.jsx)(e.code,{children:"/actuator"})," index for links"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"ProbeEndpointsStrategy"})," - Probes individual endpoints with OPTIONS requests"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"ChainingStrategy"})," - Combines multiple strategies with fallback"]}),"\n"]}),"\n",(0,r.jsx)(e.mermaid,{value:'graph TD\n    A["Client Registers<br/>POST /instances<br/>{managementUrl: \'http://client:8080/actuator\'}"] --\x3e B[EndpointDetector]\n    B --\x3e C["1. QueryIndexEndpointStrategy<br/>GET /actuator \u2192 Read _links"]\n    B --\x3e D["2. Fallback ProbeEndpointsStrategy<br/>OPTIONS /actuator/health \u2192 200 OK<br/>OPTIONS /actuator/metrics \u2192 200 OK<br/>OPTIONS /actuator/info \u2192 200 OK"]\n    C --\x3e E["Instance.endpoints updated<br/>{health, info, metrics, env, loggers, ...}"]\n    D --\x3e E'}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsx)(e.h2,{id:"default-behavior",children:"Default Behavior"}),"\n",(0,r.jsxs)(e.p,{children:["By default, Admin Server uses a ",(0,r.jsx)(e.strong,{children:"ChainingStrategy"})," that:"]}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:["First tries ",(0,r.jsx)(e.strong,{children:"QueryIndexEndpointStrategy"})," (Spring Boot 2.x+ with ",(0,r.jsx)(e.code,{children:"/actuator"})," index)"]}),"\n",(0,r.jsxs)(e.li,{children:["Falls back to ",(0,r.jsx)(e.strong,{children:"ProbeEndpointsStrategy"})," (Spring Boot 1.x or if index query fails)"]}),"\n"]}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"AdminServerAutoConfiguration.java"}),":"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-java",children:"@Bean\n@ConditionalOnMissingBean\npublic EndpointDetectionStrategy endpointDetectionStrategy(\n        InstanceWebClient instanceWebClient,\n        AdminServerProperties adminServerProperties,\n        ApiMediaTypeHandler apiMediaTypeHandler) {\n\n    return new ChainingStrategy(\n        new QueryIndexEndpointStrategy(instanceWebClient, apiMediaTypeHandler),\n        new ProbeEndpointsStrategy(instanceWebClient,\n            adminServerProperties.getProbedEndpoints())\n    );\n}\n"})}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsx)(e.h2,{id:"queryindexendpointstrategy",children:"QueryIndexEndpointStrategy"}),"\n",(0,r.jsxs)(e.p,{children:["Queries the actuator index at ",(0,r.jsx)(e.code,{children:"/actuator"})," to discover endpoints."]}),"\n",(0,r.jsx)(e.h3,{id:"how-it-works",children:"How It Works"}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Request"}),":"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-http",children:"GET /actuator HTTP/1.1\nAccept: application/vnd.spring-boot.actuator.v3+json\n"})}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Response"}),":"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-json",children:'{\n  "_links": {\n    "self": {\n      "href": "http://localhost:8080/actuator",\n      "templated": false\n    },\n    "health": {\n      "href": "http://localhost:8080/actuator/health",\n      "templated": false\n    },\n    "info": {\n      "href": "http://localhost:8080/actuator/info",\n      "templated": false\n    },\n    "metrics": {\n      "href": "http://localhost:8080/actuator/metrics/{requiredMetricName}",\n      "templated": true\n    }\n  }\n}\n'})}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Extracted Endpoints"}),":"]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.code,{children:"health"})," \u2192 ",(0,r.jsx)(e.code,{children:"http://localhost:8080/actuator/health"})]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.code,{children:"info"})," \u2192 ",(0,r.jsx)(e.code,{children:"http://localhost:8080/actuator/info"})]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.code,{children:"metrics"})," is ",(0,r.jsx)(e.strong,{children:"excluded"})," (templated)"]}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"use-only-queryindexendpointstrategy",children:"Use Only QueryIndexEndpointStrategy"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-java",children:"package com.example.admin;\n\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\n\nimport de.codecentric.boot.admin.server.services.ApiMediaTypeHandler;\nimport de.codecentric.boot.admin.server.services.endpoints.EndpointDetectionStrategy;\nimport de.codecentric.boot.admin.server.services.endpoints.QueryIndexEndpointStrategy;\nimport de.codecentric.boot.admin.server.web.client.InstanceWebClient;\n\n@Configuration\npublic class EndpointDetectionConfig {\n\n    @Bean\n    public EndpointDetectionStrategy endpointDetectionStrategy(\n            InstanceWebClient instanceWebClient,\n            ApiMediaTypeHandler apiMediaTypeHandler) {\n\n        return new QueryIndexEndpointStrategy(instanceWebClient, apiMediaTypeHandler);\n    }\n}\n"})}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"When to use"}),":"]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"All clients are Spring Boot 2.x or newer"}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.code,{children:"/actuator"})," index is available on all clients"]}),"\n",(0,r.jsx)(e.li,{children:"Want fastest detection"}),"\n"]}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsx)(e.h2,{id:"probeendpointsstrategy",children:"ProbeEndpointsStrategy"}),"\n",(0,r.jsx)(e.p,{children:"Probes individual endpoints using HTTP OPTIONS requests."}),"\n",(0,r.jsx)(e.h3,{id:"how-it-works-1",children:"How It Works"}),"\n",(0,r.jsx)(e.p,{children:"For each endpoint in the probed list:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-http",children:"OPTIONS /actuator/health HTTP/1.1\n"})}),"\n",(0,r.jsxs)(e.p,{children:["If response is ",(0,r.jsx)(e.code,{children:"2xx"}),", the endpoint is considered available."]}),"\n",(0,r.jsx)(e.h3,{id:"configuration",children:"Configuration"}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"application.yml"}),":"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-yaml",children:"spring:\n  boot:\n    admin:\n      probed-endpoints:\n        - health\n        - info\n        - metrics\n        - env\n        - loggers\n        - logfile\n        - threaddump\n        - heapdump\n"})}),"\n",(0,r.jsx)(e.h3,{id:"custom-endpoint-paths",children:"Custom Endpoint Paths"}),"\n",(0,r.jsxs)(e.p,{children:["If endpoint ID differs from path, use ",(0,r.jsx)(e.code,{children:"id:path"})," syntax:"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-yaml",children:'spring:\n  boot:\n    admin:\n      probed-endpoints:\n        - health:ping        # Endpoint ID "health" at path "/actuator/ping"\n        - metrics:stats      # Endpoint ID "metrics" at path "/actuator/stats"\n        - custom:my-custom   # Endpoint ID "custom" at path "/actuator/my-custom"\n'})}),"\n",(0,r.jsx)(e.h3,{id:"use-only-probeendpointsstrategy",children:"Use Only ProbeEndpointsStrategy"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-java",children:"package com.example.admin;\n\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\n\nimport de.codecentric.boot.admin.server.config.AdminServerProperties;\nimport de.codecentric.boot.admin.server.services.endpoints.EndpointDetectionStrategy;\nimport de.codecentric.boot.admin.server.services.endpoints.ProbeEndpointsStrategy;\nimport de.codecentric.boot.admin.server.web.client.InstanceWebClient;\n\n@Configuration\npublic class EndpointDetectionConfig {\n\n    @Bean\n    public EndpointDetectionStrategy endpointDetectionStrategy(\n            InstanceWebClient instanceWebClient,\n            AdminServerProperties properties) {\n\n        return new ProbeEndpointsStrategy(\n            instanceWebClient,\n            properties.getProbedEndpoints()\n        );\n    }\n}\n"})}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"When to use"}),":"]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"Supporting Spring Boot 1.x applications"}),"\n",(0,r.jsx)(e.li,{children:"Actuator index is disabled/unavailable"}),"\n",(0,r.jsx)(e.li,{children:"Need to detect specific custom endpoints"}),"\n"]}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsx)(e.h2,{id:"chainingstrategy",children:"ChainingStrategy"}),"\n",(0,r.jsx)(e.p,{children:"Combines multiple strategies with fallback."}),"\n",(0,r.jsx)(e.h3,{id:"how-it-works-2",children:"How It Works"}),"\n",(0,r.jsx)(e.p,{children:"Tries strategies in order until one succeeds:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-java",children:"ChainingStrategy(\n    new QueryIndexEndpointStrategy(...),  // Try first\n    new ProbeEndpointsStrategy(...)       // Fallback\n)\n"})}),"\n",(0,r.jsx)(e.p,{children:"If first strategy returns empty, tries next strategy."}),"\n",(0,r.jsx)(e.h3,{id:"custom-chaining",children:"Custom Chaining"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-java",children:"package com.example.admin;\n\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\n\nimport de.codecentric.boot.admin.server.config.AdminServerProperties;\nimport de.codecentric.boot.admin.server.services.ApiMediaTypeHandler;\nimport de.codecentric.boot.admin.server.services.endpoints.ChainingStrategy;\nimport de.codecentric.boot.admin.server.services.endpoints.EndpointDetectionStrategy;\nimport de.codecentric.boot.admin.server.services.endpoints.ProbeEndpointsStrategy;\nimport de.codecentric.boot.admin.server.services.endpoints.QueryIndexEndpointStrategy;\nimport de.codecentric.boot.admin.server.web.client.InstanceWebClient;\n\n@Configuration\npublic class EndpointDetectionConfig {\n\n    @Bean\n    public EndpointDetectionStrategy endpointDetectionStrategy(\n            InstanceWebClient instanceWebClient,\n            AdminServerProperties properties,\n            ApiMediaTypeHandler apiMediaTypeHandler) {\n\n        return new ChainingStrategy(\n            new QueryIndexEndpointStrategy(instanceWebClient, apiMediaTypeHandler),\n            new ProbeEndpointsStrategy(instanceWebClient, properties.getProbedEndpoints()),\n            new CustomEndpointStrategy()  // Your custom strategy as last resort\n        );\n    }\n}\n"})}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsx)(e.h2,{id:"custom-endpointdetectionstrategy",children:"Custom EndpointDetectionStrategy"}),"\n",(0,r.jsxs)(e.p,{children:["Implement ",(0,r.jsx)(e.code,{children:"EndpointDetectionStrategy"})," interface for custom detection logic."]}),"\n",(0,r.jsx)(e.h3,{id:"interface",children:"Interface"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-java",children:"package de.codecentric.boot.admin.server.services.endpoints;\n\nimport reactor.core.publisher.Mono;\n\nimport de.codecentric.boot.admin.server.domain.entities.Instance;\nimport de.codecentric.boot.admin.server.domain.values.Endpoints;\n\npublic interface EndpointDetectionStrategy {\n\n    Mono<Endpoints> detectEndpoints(Instance instance);\n\n}\n"})}),"\n",(0,r.jsx)(e.h3,{id:"example-static-endpoint-strategy",children:"Example: Static Endpoint Strategy"}),"\n",(0,r.jsx)(e.p,{children:"Define endpoints based on metadata:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-java",children:'package com.example.admin;\n\nimport reactor.core.publisher.Mono;\n\nimport de.codecentric.boot.admin.server.domain.entities.Instance;\nimport de.codecentric.boot.admin.server.domain.values.Endpoint;\nimport de.codecentric.boot.admin.server.domain.values.Endpoints;\nimport de.codecentric.boot.admin.server.services.endpoints.EndpointDetectionStrategy;\n\npublic class MetadataEndpointStrategy implements EndpointDetectionStrategy {\n\n    @Override\n    public Mono<Endpoints> detectEndpoints(Instance instance) {\n        String managementUrl = instance.getRegistration().getManagementUrl();\n        if (managementUrl == null) {\n            return Mono.empty();\n        }\n\n        // Read endpoints from metadata\n        String endpointList = instance.getRegistration()\n            .getMetadata()\n            .get("endpoints");\n\n        if (endpointList == null || endpointList.isBlank()) {\n            return Mono.empty();\n        }\n\n        // Parse comma-separated endpoint IDs\n        List<Endpoint> endpoints = Arrays.stream(endpointList.split(","))\n            .map(String::trim)\n            .map(id -> Endpoint.of(id, managementUrl + "/" + id))\n            .toList();\n\n        return Mono.just(Endpoints.of(endpoints));\n    }\n}\n'})}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Client Configuration"}),":"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-yaml",children:"spring:\n  boot:\n    admin:\n      client:\n        instance:\n          metadata:\n            endpoints: health,info,metrics,env\n"})}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Server Configuration"}),":"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-java",children:"@Bean\npublic EndpointDetectionStrategy endpointDetectionStrategy() {\n    return new ChainingStrategy(\n        new MetadataEndpointStrategy(),\n        new QueryIndexEndpointStrategy(...)\n    );\n}\n"})}),"\n",(0,r.jsx)(e.h3,{id:"example-service-specific-endpoints",children:"Example: Service-Specific Endpoints"}),"\n",(0,r.jsx)(e.p,{children:"Different endpoint detection based on service name:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-java",children:'package com.example.admin;\n\nimport reactor.core.publisher.Mono;\n\nimport de.codecentric.boot.admin.server.domain.entities.Instance;\nimport de.codecentric.boot.admin.server.domain.values.Endpoint;\nimport de.codecentric.boot.admin.server.domain.values.Endpoints;\nimport de.codecentric.boot.admin.server.services.endpoints.EndpointDetectionStrategy;\n\npublic class ServiceSpecificEndpointStrategy implements EndpointDetectionStrategy {\n\n    private final Map<String, List<String>> serviceEndpoints;\n\n    public ServiceSpecificEndpointStrategy() {\n        this.serviceEndpoints = Map.of(\n            "payment-service", List.of("health", "info", "metrics", "payments"),\n            "user-service", List.of("health", "info", "metrics", "users"),\n            "legacy-service", List.of("health", "info")  // Limited endpoints\n        );\n    }\n\n    @Override\n    public Mono<Endpoints> detectEndpoints(Instance instance) {\n        String serviceName = instance.getRegistration().getName();\n        String managementUrl = instance.getRegistration().getManagementUrl();\n\n        if (managementUrl == null) {\n            return Mono.empty();\n        }\n\n        List<String> endpointIds = serviceEndpoints.get(serviceName);\n        if (endpointIds == null) {\n            return Mono.empty();  // Fall back to next strategy\n        }\n\n        List<Endpoint> endpoints = endpointIds.stream()\n            .map(id -> Endpoint.of(id, managementUrl + "/" + id))\n            .toList();\n\n        return Mono.just(Endpoints.of(endpoints));\n    }\n}\n'})}),"\n",(0,r.jsx)(e.h3,{id:"example-database-driven-endpoints",children:"Example: Database-Driven Endpoints"}),"\n",(0,r.jsx)(e.p,{children:"Load endpoint configuration from database:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-java",children:'package com.example.admin;\n\nimport java.util.List;\n\nimport reactor.core.publisher.Mono;\n\nimport de.codecentric.boot.admin.server.domain.entities.Instance;\nimport de.codecentric.boot.admin.server.domain.values.Endpoint;\nimport de.codecentric.boot.admin.server.domain.values.Endpoints;\nimport de.codecentric.boot.admin.server.services.endpoints.EndpointDetectionStrategy;\n\npublic class DatabaseEndpointStrategy implements EndpointDetectionStrategy {\n\n    private final EndpointConfigRepository endpointConfigRepository;\n\n    public DatabaseEndpointStrategy(EndpointConfigRepository repository) {\n        this.endpointConfigRepository = repository;\n    }\n\n    @Override\n    public Mono<Endpoints> detectEndpoints(Instance instance) {\n        String serviceName = instance.getRegistration().getName();\n        String managementUrl = instance.getRegistration().getManagementUrl();\n\n        if (managementUrl == null) {\n            return Mono.empty();\n        }\n\n        return endpointConfigRepository.findByServiceName(serviceName)\n            .map(config -> {\n                List<Endpoint> endpoints = config.getEndpointIds().stream()\n                    .map(id -> Endpoint.of(id, managementUrl + "/" + id))\n                    .toList();\n                return Endpoints.of(endpoints);\n            })\n            .switchIfEmpty(Mono.empty());\n    }\n}\n\n@Repository\ninterface EndpointConfigRepository extends ReactiveMongoRepository<EndpointConfig, String> {\n    Mono<EndpointConfig> findByServiceName(String serviceName);\n}\n\n@Document\nclass EndpointConfig {\n    private String serviceName;\n    private List<String> endpointIds;\n    // getters/setters\n}\n'})}),"\n",(0,r.jsx)(e.h3,{id:"example-http-based-discovery",children:"Example: HTTP-Based Discovery"}),"\n",(0,r.jsx)(e.p,{children:"Fetch endpoints from custom discovery endpoint:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-java",children:'package com.example.admin;\n\nimport reactor.core.publisher.Mono;\nimport org.springframework.web.reactive.function.client.WebClient;\n\nimport de.codecentric.boot.admin.server.domain.entities.Instance;\nimport de.codecentric.boot.admin.server.domain.values.Endpoint;\nimport de.codecentric.boot.admin.server.domain.values.Endpoints;\nimport de.codecentric.boot.admin.server.services.endpoints.EndpointDetectionStrategy;\n\npublic class DiscoveryServiceEndpointStrategy implements EndpointDetectionStrategy {\n\n    private final WebClient webClient;\n\n    public DiscoveryServiceEndpointStrategy(WebClient.Builder webClientBuilder) {\n        this.webClient = webClientBuilder.baseUrl("http://discovery-service").build();\n    }\n\n    @Override\n    public Mono<Endpoints> detectEndpoints(Instance instance) {\n        String serviceName = instance.getRegistration().getName();\n        String managementUrl = instance.getRegistration().getManagementUrl();\n\n        if (managementUrl == null) {\n            return Mono.empty();\n        }\n\n        return webClient.get()\n            .uri("/services/{name}/endpoints", serviceName)\n            .retrieve()\n            .bodyToFlux(String.class)\n            .collectList()\n            .map(endpointIds -> {\n                List<Endpoint> endpoints = endpointIds.stream()\n                    .map(id -> Endpoint.of(id, managementUrl + "/" + id))\n                    .toList();\n                return Endpoints.of(endpoints);\n            })\n            .onErrorResume(e -> Mono.empty());\n    }\n}\n'})}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsx)(e.h2,{id:"endpoint-detection-lifecycle",children:"Endpoint Detection Lifecycle"}),"\n",(0,r.jsx)(e.h3,{id:"when-detection-occurs",children:"When Detection Occurs"}),"\n",(0,r.jsx)(e.p,{children:"Endpoints are detected:"}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"After instance registration"})," (InstanceRegisteredEvent)"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"When endpoints are first accessed"})," (if not yet detected)"]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Periodically"})," (can be triggered manually)"]}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"trigger-manual-detection",children:"Trigger Manual Detection"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-java",children:"@Autowired\nprivate EndpointDetector endpointDetector;\n\npublic void refreshEndpoints(InstanceId instanceId) {\n    endpointDetector.detectEndpoints(instanceId).subscribe();\n}\n"})}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsx)(e.h2,{id:"debugging-endpoint-detection",children:"Debugging Endpoint Detection"}),"\n",(0,r.jsx)(e.h3,{id:"enable-debug-logging",children:"Enable Debug Logging"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-yaml",children:"logging:\n  level:\n    de.codecentric.boot.admin.server.services.EndpointDetector: DEBUG\n    de.codecentric.boot.admin.server.services.endpoints: DEBUG\n"})}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Log Output"}),":"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"DEBUG EndpointDetector - Detect endpoints for Instance{id=abc123}\nDEBUG QueryIndexEndpointStrategy - Querying actuator-index for instance abc123 on 'http://client:8080/actuator' successful.\nDEBUG EndpointDetector - Detected endpoints: [health, info, metrics, env]\n"})}),"\n",(0,r.jsx)(e.h3,{id:"check-detected-endpoints",children:"Check Detected Endpoints"}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"API"}),":"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"curl http://admin-server:8080/instances/{id} | jq '.endpoints'\n"})}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Response"}),":"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-json",children:'[\n  {\n    "id": "health",\n    "url": "http://localhost:8080/actuator/health"\n  },\n  {\n    "id": "info",\n    "url": "http://localhost:8080/actuator/info"\n  },\n  {\n    "id": "metrics",\n    "url": "http://localhost:8080/actuator/metrics"\n  }\n]\n'})}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsx)(e.h2,{id:"advanced-scenarios",children:"Advanced Scenarios"}),"\n",(0,r.jsx)(e.h3,{id:"scenario-1-legacy-spring-boot-1x-support",children:"Scenario 1: Legacy Spring Boot 1.x Support"}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Configuration"}),":"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-yaml",children:"spring:\n  boot:\n    admin:\n      probed-endpoints:\n        # Spring Boot 1.x endpoints\n        - health\n        - info\n        - metrics\n        - env\n        - trace:httptrace\n        - dump:threaddump\n"})}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Strategy"}),":"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-java",children:"@Bean\npublic EndpointDetectionStrategy endpointDetectionStrategy(\n        InstanceWebClient instanceWebClient,\n        AdminServerProperties properties) {\n\n    // Only use probing for legacy apps\n    return new ProbeEndpointsStrategy(\n        instanceWebClient,\n        properties.getProbedEndpoints()\n    );\n}\n"})}),"\n",(0,r.jsx)(e.h3,{id:"scenario-2-mixed-spring-boot-versions",children:"Scenario 2: Mixed Spring Boot Versions"}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Strategy"}),":"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-java",children:"@Bean\npublic EndpointDetectionStrategy endpointDetectionStrategy(\n        InstanceWebClient instanceWebClient,\n        AdminServerProperties properties,\n        ApiMediaTypeHandler apiMediaTypeHandler) {\n\n    return new ChainingStrategy(\n        // Try modern Spring Boot 2.x+ first\n        new QueryIndexEndpointStrategy(instanceWebClient, apiMediaTypeHandler),\n        // Fall back to probing for legacy apps\n        new ProbeEndpointsStrategy(instanceWebClient, properties.getProbedEndpoints())\n    );\n}\n"})}),"\n",(0,r.jsx)(e.h3,{id:"scenario-3-custom-actuator-path",children:"Scenario 3: Custom Actuator Path"}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Client"})," (custom actuator base path):"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-yaml",children:"management:\n  endpoints:\n    web:\n      base-path: /management  # Not /actuator\n"})}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Server Strategy"}),":"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-java",children:'public class CustomPathEndpointStrategy implements EndpointDetectionStrategy {\n\n    @Override\n    public Mono<Endpoints> detectEndpoints(Instance instance) {\n        String managementUrl = instance.getRegistration().getManagementUrl();\n\n        // Adjust for custom base path\n        if (managementUrl != null && !managementUrl.endsWith("/actuator")) {\n            // Query custom index endpoint\n            return queryIndex(instance, managementUrl);\n        }\n\n        return Mono.empty();\n    }\n}\n'})}),"\n",(0,r.jsx)(e.h3,{id:"scenario-4-conditional-detection-based-on-metadata",children:"Scenario 4: Conditional Detection Based on Metadata"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-java",children:'public class ConditionalEndpointStrategy implements EndpointDetectionStrategy {\n\n    private final QueryIndexEndpointStrategy queryStrategy;\n    private final ProbeEndpointsStrategy probeStrategy;\n\n    @Override\n    public Mono<Endpoints> detectEndpoints(Instance instance) {\n        String version = instance.getRegistration()\n            .getMetadata()\n            .get("spring-boot-version");\n\n        if (version != null && version.startsWith("1.")) {\n            // Use probing for Spring Boot 1.x\n            return probeStrategy.detectEndpoints(instance);\n        } else {\n            // Use index query for Spring Boot 2.x+\n            return queryStrategy.detectEndpoints(instance);\n        }\n    }\n}\n'})}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsx)(e.h2,{id:"performance-considerations",children:"Performance Considerations"}),"\n",(0,r.jsx)(e.h3,{id:"queryindexendpointstrategy-1",children:"QueryIndexEndpointStrategy"}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Pros"}),":"]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"Single HTTP request"}),"\n",(0,r.jsx)(e.li,{children:"Fast detection"}),"\n",(0,r.jsx)(e.li,{children:"Accurate (no false positives)"}),"\n"]}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Cons"}),":"]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"Requires Spring Boot 2.x+"}),"\n",(0,r.jsxs)(e.li,{children:["Requires ",(0,r.jsx)(e.code,{children:"/actuator"})," index enabled"]}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"probeendpointsstrategy-1",children:"ProbeEndpointsStrategy"}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Pros"}),":"]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"Works with any Spring Boot version"}),"\n",(0,r.jsx)(e.li,{children:"Detects custom endpoints"}),"\n"]}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Cons"}),":"]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"Multiple HTTP requests (one per endpoint)"}),"\n",(0,r.jsx)(e.li,{children:"Slower detection"}),"\n",(0,r.jsx)(e.li,{children:"Potential false positives if OPTIONS not supported"}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"optimization",children:"Optimization"}),"\n",(0,r.jsx)(e.p,{children:"Limit probed endpoints to essentials:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-yaml",children:"spring:\n  boot:\n    admin:\n      probed-endpoints:\n        - health\n        - info\n        - metrics\n        # Remove rarely-used endpoints\n"})}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsx)(e.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,r.jsx)(e.h3,{id:"issue-no-endpoints-detected",children:"Issue: No endpoints detected"}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Cause"}),": Detection strategy failing."]}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Debug"}),":"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-yaml",children:"logging:\n  level:\n    de.codecentric.boot.admin.server.services.endpoints: DEBUG\n"})}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Check"}),":"]}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.code,{children:"managementUrl"})," is set"]}),"\n",(0,r.jsx)(e.li,{children:"Instance is reachable"}),"\n",(0,r.jsx)(e.li,{children:"Actuator endpoints are exposed"}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"issue-wrong-endpoints-detected",children:"Issue: Wrong endpoints detected"}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Cause"}),": Probing detecting endpoints that don't exist."]}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Solution"}),": Use ",(0,r.jsx)(e.code,{children:"QueryIndexEndpointStrategy"})," only:"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-java",children:"@Bean\npublic EndpointDetectionStrategy endpointDetectionStrategy(\n        InstanceWebClient instanceWebClient,\n        ApiMediaTypeHandler apiMediaTypeHandler) {\n    return new QueryIndexEndpointStrategy(instanceWebClient, apiMediaTypeHandler);\n}\n"})}),"\n",(0,r.jsx)(e.h3,{id:"issue-custom-endpoints-not-detected",children:"Issue: Custom endpoints not detected"}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Cause"}),": Custom endpoints not in probed list or not in actuator index."]}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Solution"}),": Add to probed endpoints:"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-yaml",children:"spring:\n  boot:\n    admin:\n      probed-endpoints:\n        - health\n        - info\n        - my-custom-endpoint\n"})}),"\n",(0,r.jsx)(e.p,{children:"Or create custom strategy."}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsx)(e.h2,{id:"see-also",children:"See Also"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.a,{href:"/4.0.0/docs/server/server",children:"Server Configuration"})}),"\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.a,{href:"https://docs.spring.io/spring-boot/reference/actuator/endpoints.html",children:"Spring Boot Actuator Endpoints"})}),"\n"]}),"\n",(0,r.jsx)(e.hr,{}),"\n",(0,r.jsx)(e.h2,{id:"complete-example",children:"Complete Example"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-java",children:'package com.example.admin;\n\nimport java.util.Arrays;\nimport java.util.List;\n\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport reactor.core.publisher.Mono;\n\nimport de.codecentric.boot.admin.server.config.AdminServerProperties;\nimport de.codecentric.boot.admin.server.domain.entities.Instance;\nimport de.codecentric.boot.admin.server.domain.values.Endpoint;\nimport de.codecentric.boot.admin.server.domain.values.Endpoints;\nimport de.codecentric.boot.admin.server.services.ApiMediaTypeHandler;\nimport de.codecentric.boot.admin.server.services.endpoints.ChainingStrategy;\nimport de.codecentric.boot.admin.server.services.endpoints.EndpointDetectionStrategy;\nimport de.codecentric.boot.admin.server.services.endpoints.ProbeEndpointsStrategy;\nimport de.codecentric.boot.admin.server.services.endpoints.QueryIndexEndpointStrategy;\nimport de.codecentric.boot.admin.server.web.client.InstanceWebClient;\n\n@Configuration\npublic class EndpointDetectionConfig {\n\n    @Bean\n    public EndpointDetectionStrategy endpointDetectionStrategy(\n            InstanceWebClient instanceWebClient,\n            AdminServerProperties properties,\n            ApiMediaTypeHandler apiMediaTypeHandler) {\n\n        return new ChainingStrategy(\n            // 1. Try metadata-based detection\n            new MetadataEndpointStrategy(),\n            // 2. Try standard actuator index query\n            new QueryIndexEndpointStrategy(instanceWebClient, apiMediaTypeHandler),\n            // 3. Fall back to probing\n            new ProbeEndpointsStrategy(instanceWebClient, properties.getProbedEndpoints())\n        );\n    }\n\n    /**\n     * Detect endpoints from instance metadata\n     */\n    static class MetadataEndpointStrategy implements EndpointDetectionStrategy {\n\n        @Override\n        public Mono<Endpoints> detectEndpoints(Instance instance) {\n            String managementUrl = instance.getRegistration().getManagementUrl();\n            if (managementUrl == null) {\n                return Mono.empty();\n            }\n\n            String endpointList = instance.getRegistration()\n                .getMetadata()\n                .get("endpoints");\n\n            if (endpointList == null || endpointList.isBlank()) {\n                return Mono.empty();\n            }\n\n            List<Endpoint> endpoints = Arrays.stream(endpointList.split(","))\n                .map(String::trim)\n                .map(id -> Endpoint.of(id, managementUrl + "/" + id))\n                .toList();\n\n            return Mono.just(Endpoints.of(endpoints));\n        }\n    }\n}\n'})}),"\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Client Configuration"})," (optional metadata):"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-yaml",children:"spring:\n  boot:\n    admin:\n      client:\n        instance:\n          metadata:\n            endpoints: health,info,metrics,custom\n"})})]})}function p(n={}){const{wrapper:e}={...(0,o.R)(),...n.components};return e?(0,r.jsx)(e,{...n,children:(0,r.jsx)(l,{...n})}):l(n)}},8453:(n,e,t)=>{t.d(e,{R:()=>s,x:()=>a});var i=t(6540);const r={},o=i.createContext(r);function s(n){const e=i.useContext(o);return i.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function a(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(r):n.components||r:s(n.components),i.createElement(o.Provider,{value:e},n.children)}}}]);