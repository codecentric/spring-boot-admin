"use strict";(self.webpackChunksite=self.webpackChunksite||[]).push([[3745],{4125:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>o,default:()=>u,frontMatter:()=>a,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"server/security","title":"Foster Security","description":"Since there are several approaches on solving authentication and authorization in distributed web applications Spring","source":"@site/docs/02-server/02-security.md","sourceDirName":"02-server","slug":"/server/security","permalink":"/4.1.0-SNAPSHOT/docs/server/security","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_custom_props":{"icon":"shield"}},"sidebar":"sidebar","previous":{"title":"Set up server","permalink":"/4.1.0-SNAPSHOT/docs/server/server"},"next":{"title":"Server(-Sent) Events","permalink":"/4.1.0-SNAPSHOT/docs/server/Events"}}');var s=n(4848),i=n(8453);const a={sidebar_custom_props:{icon:"shield"}},o="Foster Security",c={},d=[{value:"Securing Client Actuator Endpoints",id:"securing-client-actuator-endpoints",level:2},{value:"SBA Client",id:"sba-client",level:3},{value:"SBA Server",id:"sba-server",level:3},{value:"Eureka",id:"eureka",level:3},{value:"Consul",id:"consul",level:3},{value:"CSRF on Actuator Endpoints",id:"csrf-on-actuator-endpoints",level:2}];function l(e){const t={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.header,{children:(0,s.jsx)(t.h1,{id:"foster-security",children:"Foster Security"})}),"\n",(0,s.jsxs)(t.p,{children:["Since there are several approaches on solving authentication and authorization in distributed web applications Spring\nBoot Admin doesn't ship a default one. By default ",(0,s.jsx)(t.code,{children:"spring-boot-admin-server-ui"})," provides a login page and a logout\nbutton."]}),"\n",(0,s.jsx)(t.p,{children:"A Spring Security configuration for your server could look like this:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-java",metastring:'title="SecuritySecureConfig.java"',children:'\n@Configuration(proxyBeanMethods = false)\npublic class SecuritySecureConfig {\n\n\tprivate final AdminServerProperties adminServer;\n\n\tprivate final SecurityProperties security;\n\n\tpublic SecuritySecureConfig(AdminServerProperties adminServer, SecurityProperties security) {\n\t\tthis.adminServer = adminServer;\n\t\tthis.security = security;\n\t}\n\n\t@Bean\n\tprotected SecurityFilterChain filterChain(HttpSecurity http) throws Exception {\n\t\tSavedRequestAwareAuthenticationSuccessHandler successHandler = new SavedRequestAwareAuthenticationSuccessHandler();\n\t\tsuccessHandler.setTargetUrlParameter("redirectTo");\n\t\tsuccessHandler.setDefaultTargetUrl(this.adminServer.path("/"));\n\n\t\thttp.authorizeHttpRequests((authorizeRequests) -> authorizeRequests //\n\t\t\t\t\t\t.requestMatchers(new AntPathRequestMatcher(this.adminServer.path("/assets/**")))\n\t\t\t\t\t\t.permitAll() // (1)\n\t\t\t\t\t\t.requestMatchers(new AntPathRequestMatcher(this.adminServer.path("/actuator/info")))\n\t\t\t\t\t\t.permitAll()\n\t\t\t\t\t\t.requestMatchers(new AntPathRequestMatcher(adminServer.path("/actuator/health")))\n\t\t\t\t\t\t.permitAll()\n\t\t\t\t\t\t.requestMatchers(new AntPathRequestMatcher(this.adminServer.path("/login")))\n\t\t\t\t\t\t.permitAll()\n\t\t\t\t\t\t.dispatcherTypeMatchers(DispatcherType.ASYNC)\n\t\t\t\t\t\t.permitAll() // https://github.com/spring-projects/spring-security/issues/11027\n\t\t\t\t\t\t.anyRequest()\n\t\t\t\t\t\t.authenticated()) // (2)\n\t\t\t\t.formLogin(\n\t\t\t\t\t\t(formLogin) -> formLogin.loginPage(this.adminServer.path("/login")).successHandler(successHandler)) // (3)\n\t\t\t\t.logout((logout) -> logout.logoutUrl(this.adminServer.path("/logout")))\n\t\t\t\t.httpBasic(Customizer.withDefaults()); // (4)\n\n\t\thttp.addFilterAfter(new CustomCsrfFilter(), BasicAuthenticationFilter.class) // (5)\n\t\t\t\t.csrf((csrf) -> csrf.csrfTokenRepository(CookieCsrfTokenRepository.withHttpOnlyFalse())\n\t\t\t\t\t\t.csrfTokenRequestHandler(new CsrfTokenRequestAttributeHandler())\n\t\t\t\t\t\t.ignoringRequestMatchers(\n\t\t\t\t\t\t\t\tnew AntPathRequestMatcher(this.adminServer.path("/instances"), POST.toString()), // (6)\n\t\t\t\t\t\t\t\tnew AntPathRequestMatcher(this.adminServer.path("/instances/*"), DELETE.toString()), // (6)\n\t\t\t\t\t\t\t\tnew AntPathRequestMatcher(this.adminServer.path("/actuator/**")) // (7)\n\t\t\t\t\t\t));\n\n\t\thttp.rememberMe((rememberMe) -> rememberMe.key(UUID.randomUUID().toString()).tokenValiditySeconds(1209600));\n\n\t\treturn http.build();\n\n\t}\n\n\t// Required to provide UserDetailsService for "remember functionality"\n\t@Bean\n\tpublic InMemoryUserDetailsManager userDetailsService(PasswordEncoder passwordEncoder) {\n\t\tUserDetails user = User.withUsername("user").password(passwordEncoder.encode("password")).roles("USER").build();\n\t\treturn new InMemoryUserDetailsManager(user);\n\t}\n\n\t@Bean\n\tpublic PasswordEncoder passwordEncoder() {\n\t\treturn new BCryptPasswordEncoder();\n\t}\n\n}\n'})}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsx)(t.li,{children:"Grants public access to all static assets and the login page."}),"\n",(0,s.jsx)(t.li,{children:"Every other request must be authenticated."}),"\n",(0,s.jsx)(t.li,{children:"Configures login and logout."}),"\n",(0,s.jsx)(t.li,{children:"Enables HTTP-Basic support. This is needed for the Spring Boot Admin Client to register."}),"\n",(0,s.jsx)(t.li,{children:"Enables CSRF-Protection using Cookies"}),"\n",(0,s.jsx)(t.li,{children:"Disables CSRF-Protection for the endpoint the Spring Boot Admin Client uses to (de-)register."}),"\n",(0,s.jsx)(t.li,{children:"Disables CSRF-Protection for the actuator endpoints."}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:"In case you use the Spring Boot Admin Client, it needs the credentials for accessing the server:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-yaml",metastring:'title="application.yml"',children:"spring.boot.admin.client:\n  username: sba-client\n  password: s3cret\n"})}),"\n",(0,s.jsxs)(t.p,{children:["For a complete sample look\nat ",(0,s.jsx)(t.a,{href:"https://github.com/codecentric/spring-boot-admin/tree/master/spring-boot-admin-samples/spring-boot-admin-sample-servlet/",children:"spring-boot-admin-sample-servlet"}),"."]}),"\n",(0,s.jsx)(t.admonition,{type:"note",children:(0,s.jsx)(t.p,{children:"If you protect the /instances endpoint don't forget to configure the username and password on your SBA-Client using\nspring.boot.admin.client.username and spring.boot.admin.client.password."})}),"\n",(0,s.jsx)(t.h2,{id:"securing-client-actuator-endpoints",children:"Securing Client Actuator Endpoints"}),"\n",(0,s.jsxs)(t.p,{children:["When the actuator endpoints are secured using HTTP Basic authentication the SBA Server needs credentials to access them.\nYou can submit the credentials in the metadata when registering the application. The ",(0,s.jsx)(t.code,{children:"BasicAuthHttpHeaderProvider"})," then\nuses this metadata to add the ",(0,s.jsx)(t.code,{children:"Authorization"})," header to access your application's actuator endpoints. You can provide\nyour own ",(0,s.jsx)(t.code,{children:"HttpHeadersProvider"})," to alter the behaviour (e.g. add some decryption) or add extra headers."]}),"\n",(0,s.jsx)(t.admonition,{type:"note",children:(0,s.jsx)(t.p,{children:"The SBA Server masks certain metadata in the HTTP interface to prevent leaking of sensitive information."})}),"\n",(0,s.jsx)(t.admonition,{type:"warning",children:(0,s.jsx)(t.p,{children:"You should configure HTTPS for your SBA Server or (service registry) when transferring credentials via the metadata."})}),"\n",(0,s.jsx)(t.admonition,{type:"warning",children:(0,s.jsx)(t.p,{children:"When using Spring Cloud Discovery, you must be aware that anybody who can query your service registry can obtain the\ncredentials."})}),"\n",(0,s.jsx)(t.admonition,{type:"tip",children:(0,s.jsxs)(t.p,{children:["When using this approach the SBA Server decides whether the user can access the registered applications. There are more\ncomplex solutions possible (using OAuth2) to let the clients decide if the user can access the endpoints. For that\nplease have a look at the samples\nin ",(0,s.jsx)(t.a,{href:"https://github.com/joshiste/spring-boot-admin-samples",children:"joshiste/spring-boot-admin-samples"}),"."]})}),"\n",(0,s.jsx)(t.h3,{id:"sba-client",children:"SBA Client"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-yaml",metastring:'title="application.yml"',children:"spring.boot.admin.client:\n  url: http://localhost:8080\n  instance:\n    metadata:\n      user.name: ${spring.security.user.name}\n      user.password: ${spring.security.user.password}\n"})}),"\n",(0,s.jsx)(t.h3,{id:"sba-server",children:"SBA Server"}),"\n",(0,s.jsx)(t.p,{children:"You can specify credentials via configuration properties in your admin server."}),"\n",(0,s.jsx)(t.admonition,{type:"tip",children:(0,s.jsxs)(t.p,{children:["You can use this in conjunction\nwith ",(0,s.jsx)(t.a,{href:"https://cloud.spring.io/spring-cloud-kubernetes/1.1.x/reference/html/#secrets-propertysource",children:"spring-cloud-kubernetes"}),"\nto pull credentials from ",(0,s.jsx)(t.a,{href:"https://kubernetes.io/docs/concepts/configuration/secret/",children:"secrets"}),"."]})}),"\n",(0,s.jsxs)(t.p,{children:["To enable pulling credentials from properties the ",(0,s.jsx)(t.code,{children:"spring.boot.admin.instance-auth.enabled"})," property must be ",(0,s.jsx)(t.code,{children:"true"})," (\ndefault)."]}),"\n",(0,s.jsx)(t.admonition,{type:"note",children:(0,s.jsx)(t.p,{children:"If your clients provide credentials via metadata (i.e., via service annotations), that metadata will be used instead of\nthe properties."})}),"\n",(0,s.jsxs)(t.p,{children:["You can provide a default username and password by setting ",(0,s.jsx)(t.code,{children:"spring.boot.admin.instance-auth.default-user-name"})," and\n",(0,s.jsx)(t.code,{children:"spring.boot.admin.instance-auth.default-user-password"}),". Optionally you can provide credentials for specific services (\nby name) using the ",(0,s.jsx)(t.code,{children:"spring.boot.admin.instance-auth.service-map.*.user-name"})," pattern, replacing ",(0,s.jsx)(t.code,{children:"*"})," with the service\nname."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-yaml",metastring:'title="application.yml"',children:'spring.boot.admin:\n  instance-auth:\n    enabled: true\n    default-user-name: "${some.user.name.from.secret}"\n    default-password: "${some.user.password.from.secret}"\n    service-map:\n      my-first-service-to-monitor:\n        user-name: "${some.user.name.from.secret}"\n        user-password: "${some.user.password.from.secret}"\n      my-second-service-to-monitor:\n        user-name: "${some.user.name.from.secret}"\n        user-password: "${some.user.password.from.secret}"\n'})}),"\n",(0,s.jsx)(t.h3,{id:"eureka",children:"Eureka"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-yaml",metastring:'title="application.yml"',children:"eureka:\n  instance:\n    metadata-map:\n      user.name: ${spring.security.user.name}\n      user.password: ${spring.security.user.password}\n"})}),"\n",(0,s.jsx)(t.h3,{id:"consul",children:"Consul"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-yaml",metastring:'title="application.yml"',children:"spring.cloud.consul:\n  discovery:\n    metadata:\n      user-name: ${spring.security.user.name}\n      user-password: ${spring.security.user.password}\n"})}),"\n",(0,s.jsx)(t.admonition,{type:"warning",children:(0,s.jsx)(t.p,{children:'Consul does not allow dots (".") in metadata keys, use dashes instead.'})}),"\n",(0,s.jsx)(t.h2,{id:"csrf-on-actuator-endpoints",children:"CSRF on Actuator Endpoints"}),"\n",(0,s.jsxs)(t.p,{children:["Some of the actuator endpoints (e.g. ",(0,s.jsx)(t.code,{children:"/loggers"}),") support POST requests. When using Spring Security you need to ignore\nthe actuator endpoints for CSRF-Protection as the Spring Boot Admin Server currently lacks support."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-java",metastring:'title="SecuritySecureConfig.java"',children:'\n@Bean\nprivate SecurityFilterChain filterChain(HttpSecurity http) {\n\treturn http.csrf(c -> c.ignoringRequestMatchers("/actuator/**")).build();\n}\n'})})]})}function u(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>a,x:()=>o});var r=n(6540);const s={},i=r.createContext(s);function a(e){const t=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),r.createElement(i.Provider,{value:t},e.children)}}}]);