"use strict";(self.webpackChunksite=self.webpackChunksite||[]).push([[3762],{8482:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>p,frontMatter:()=>r,metadata:()=>a,toc:()=>d});const a=JSON.parse('{"id":"customization/monitoring/custom-health-status","title":"Custom Health Status","description":"Customize how Spring Boot Admin Server retrieves and interprets health status from instances.","source":"@site/docs/06-customization/monitoring/02-custom-health-status.md","sourceDirName":"06-customization/monitoring","slug":"/customization/monitoring/custom-health-status","permalink":"/4.1.0-SNAPSHOT/docs/customization/monitoring/custom-health-status","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2,"sidebar_custom_props":{"icon":"wrench"}},"sidebar":"sidebar","previous":{"title":"Instance Filters","permalink":"/4.1.0-SNAPSHOT/docs/customization/monitoring/instance-filters"},"next":{"title":"Custom Endpoint Detection","permalink":"/4.1.0-SNAPSHOT/docs/customization/server/endpoint-detection"}}');var i=t(4848),s=t(8453);const r={sidebar_position:2,sidebar_custom_props:{icon:"wrench"}},o="Custom Health Status",c={},d=[{value:"Overview",id:"overview",level:2},{value:"Default Behavior",id:"default-behavior",level:2},{value:"StatusUpdater",id:"statusupdater",level:3},{value:"StatusInfo",id:"statusinfo",level:2},{value:"Built-in Status Codes",id:"built-in-status-codes",level:3},{value:"Creating StatusInfo",id:"creating-statusinfo",level:3},{value:"Custom StatusUpdater",id:"custom-statusupdater",level:2},{value:"Example: Custom Timeout",id:"example-custom-timeout",level:3},{value:"Example: Custom Status Interpretation",id:"example-custom-status-interpretation",level:3},{value:"Example: Custom Health Endpoint",id:"example-custom-health-endpoint",level:3},{value:"Example: Combine Multiple Health Checks",id:"example-combine-multiple-health-checks",level:3},{value:"Custom InfoUpdater",id:"custom-infoupdater",level:2},{value:"Default Behavior",id:"default-behavior-1",level:3},{value:"Example: Custom Info Endpoint",id:"example-custom-info-endpoint",level:3},{value:"Example: Enrich Info with Metadata",id:"example-enrich-info-with-metadata",level:3},{value:"Custom Status Codes",id:"custom-status-codes",level:2},{value:"Advanced Scenarios",id:"advanced-scenarios",level:2},{value:"Scenario 1: External Health Check",id:"scenario-1-external-health-check",level:3},{value:"Scenario 2: Synthetic Monitoring",id:"scenario-2-synthetic-monitoring",level:3},{value:"Scenario 3: Database-Backed Status",id:"scenario-3-database-backed-status",level:3},{value:"Debugging",id:"debugging",level:2},{value:"Enable Debug Logging",id:"enable-debug-logging",level:3},{value:"Monitor Status Updates",id:"monitor-status-updates",level:3},{value:"Complete Example",id:"complete-example",level:2},{value:"See Also",id:"see-also",level:2}];function l(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"custom-health-status",children:"Custom Health Status"})}),"\n",(0,i.jsx)(n.p,{children:"Customize how Spring Boot Admin Server retrieves and interprets health status from instances."}),"\n",(0,i.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,i.jsxs)(n.p,{children:["The Admin Server monitors instance health by querying the ",(0,i.jsx)(n.code,{children:"/actuator/health"})," endpoint. You can customize:"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"StatusUpdater"})," - How health status is retrieved and parsed"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"InfoUpdater"})," - How instance info is retrieved"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Status interpretation"})," - Custom status codes and logic"]}),"\n"]}),"\n",(0,i.jsx)(n.mermaid,{value:"graph TD\n    A[StatusUpdater every 10 seconds] --\x3e B[GET /actuator/health]\n    B --\x3e C[Parse response]\n    C --\x3e D[Create StatusInfo]\n    D --\x3e E[Update Instance.statusInfo]"}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"default-behavior",children:"Default Behavior"}),"\n",(0,i.jsx)(n.h3,{id:"statusupdater",children:"StatusUpdater"}),"\n",(0,i.jsxs)(n.p,{children:["By default, ",(0,i.jsx)(n.code,{children:"StatusUpdater"})," queries the health endpoint:"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"StatusUpdater.java"})," (simplified):"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'protected Mono<Instance> doUpdateStatus(Instance instance) {\n    return instanceWebClient.instance(instance)\n        .get()\n        .uri(Endpoint.HEALTH)\n        .exchangeToMono(this::convertStatusInfo)\n        .timeout(Duration.ofSeconds(10))\n        .onErrorResume(this::handleError)\n        .map(instance::withStatusInfo);\n}\n\nprotected StatusInfo getStatusInfoFromStatus(HttpStatusCode httpStatus, Map<String, ?> body) {\n    if (httpStatus.is2xxSuccessful()) {\n        return StatusInfo.ofUp();\n    }\n    // Return DOWN with error details\n    return StatusInfo.ofDown(details);\n}\n\nprivate Mono<StatusInfo> handleError(Throwable ex) {\n    Map<String, Object> details = new HashMap<>();\n    details.put("message", ex.getMessage());\n    details.put("exception", ex.getClass().getName());\n    return Mono.just(StatusInfo.ofOffline(details));\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Status Mapping"}),":"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["HTTP 2xx \u2192 ",(0,i.jsx)(n.code,{children:"UP"})]}),"\n",(0,i.jsxs)(n.li,{children:["HTTP 4xx/5xx \u2192 ",(0,i.jsx)(n.code,{children:"DOWN"})]}),"\n",(0,i.jsxs)(n.li,{children:["Network error \u2192 ",(0,i.jsx)(n.code,{children:"OFFLINE"})]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"statusinfo",children:"StatusInfo"}),"\n",(0,i.jsx)(n.h3,{id:"built-in-status-codes",children:"Built-in Status Codes"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'public static final String STATUS_UNKNOWN = "UNKNOWN";\npublic static final String STATUS_OUT_OF_SERVICE = "OUT_OF_SERVICE";\npublic static final String STATUS_UP = "UP";\npublic static final String STATUS_DOWN = "DOWN";\npublic static final String STATUS_OFFLINE = "OFFLINE";\npublic static final String STATUS_RESTRICTED = "RESTRICTED";\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Status Priority"})," (highest to lowest):"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"DOWN"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"OUT_OF_SERVICE"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"OFFLINE"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"UNKNOWN"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"RESTRICTED"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"UP"})}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"creating-statusinfo",children:"Creating StatusInfo"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'// UP status\nStatusInfo.ofUp();\nStatusInfo.ofUp(Map.of("version", "1.0.0"));\n\n// DOWN status\nStatusInfo.ofDown();\nStatusInfo.ofDown(Map.of("error", "Database unreachable"));\n\n// OFFLINE status\nStatusInfo.ofOffline();\nStatusInfo.ofOffline(Map.of("message", "Connection timeout"));\n\n// Custom status\nStatusInfo.valueOf("DEGRADED", Map.of("reason", "High latency"));\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"custom-statusupdater",children:"Custom StatusUpdater"}),"\n",(0,i.jsx)(n.h3,{id:"example-custom-timeout",children:"Example: Custom Timeout"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:"package com.example.admin;\n\nimport java.time.Duration;\n\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\n\nimport de.codecentric.boot.admin.server.domain.entities.InstanceRepository;\nimport de.codecentric.boot.admin.server.services.ApiMediaTypeHandler;\nimport de.codecentric.boot.admin.server.services.StatusUpdater;\nimport de.codecentric.boot.admin.server.web.client.InstanceWebClient;\n\n@Configuration\npublic class StatusUpdaterConfig {\n\n    @Bean\n    public StatusUpdater statusUpdater(\n            InstanceRepository repository,\n            InstanceWebClient instanceWebClient,\n            ApiMediaTypeHandler apiMediaTypeHandler) {\n\n        return new StatusUpdater(repository, instanceWebClient, apiMediaTypeHandler)\n            .timeout(Duration.ofSeconds(30));  // Increase timeout\n    }\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"example-custom-status-interpretation",children:"Example: Custom Status Interpretation"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'package com.example.admin;\n\nimport java.util.Map;\n\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.http.HttpStatusCode;\n\nimport de.codecentric.boot.admin.server.domain.entities.InstanceRepository;\nimport de.codecentric.boot.admin.server.domain.values.StatusInfo;\nimport de.codecentric.boot.admin.server.services.ApiMediaTypeHandler;\nimport de.codecentric.boot.admin.server.services.StatusUpdater;\nimport de.codecentric.boot.admin.server.web.client.InstanceWebClient;\n\n@Configuration\npublic class StatusUpdaterConfig {\n\n    @Bean\n    public StatusUpdater statusUpdater(\n            InstanceRepository repository,\n            InstanceWebClient instanceWebClient,\n            ApiMediaTypeHandler apiMediaTypeHandler) {\n\n        return new CustomStatusUpdater(repository, instanceWebClient, apiMediaTypeHandler);\n    }\n\n    static class CustomStatusUpdater extends StatusUpdater {\n\n        public CustomStatusUpdater(\n                InstanceRepository repository,\n                InstanceWebClient instanceWebClient,\n                ApiMediaTypeHandler apiMediaTypeHandler) {\n            super(repository, instanceWebClient, apiMediaTypeHandler);\n        }\n\n        @Override\n        protected StatusInfo getStatusInfoFromStatus(HttpStatusCode httpStatus, Map<String, ?> body) {\n            // Custom logic: 503 Service Unavailable = OUT_OF_SERVICE\n            if (httpStatus.value() == 503) {\n                return StatusInfo.valueOf("OUT_OF_SERVICE", body);\n            }\n\n            // Custom logic: 429 Too Many Requests = RESTRICTED\n            if (httpStatus.value() == 429) {\n                return StatusInfo.valueOf("RESTRICTED",\n                    Map.of("reason", "Rate limited"));\n            }\n\n            // Delegate to default behavior\n            return super.getStatusInfoFromStatus(httpStatus, body);\n        }\n    }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"example-custom-health-endpoint",children:"Example: Custom Health Endpoint"}),"\n",(0,i.jsx)(n.p,{children:"Query a different health endpoint:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'package com.example.admin;\n\nimport reactor.core.publisher.Mono;\n\nimport de.codecentric.boot.admin.server.domain.entities.Instance;\nimport de.codecentric.boot.admin.server.domain.entities.InstanceRepository;\nimport de.codecentric.boot.admin.server.services.ApiMediaTypeHandler;\nimport de.codecentric.boot.admin.server.services.StatusUpdater;\nimport de.codecentric.boot.admin.server.web.client.InstanceWebClient;\n\npublic class CustomHealthEndpointStatusUpdater extends StatusUpdater {\n\n    public CustomHealthEndpointStatusUpdater(\n            InstanceRepository repository,\n            InstanceWebClient instanceWebClient,\n            ApiMediaTypeHandler apiMediaTypeHandler) {\n        super(repository, instanceWebClient, apiMediaTypeHandler);\n    }\n\n    @Override\n    protected Mono<Instance> doUpdateStatus(Instance instance) {\n        if (!instance.isRegistered()) {\n            return Mono.empty();\n        }\n\n        // Query custom health endpoint based on metadata\n        String customHealthPath = instance.getRegistration()\n            .getMetadata()\n            .getOrDefault("health-path", "/actuator/health");\n\n        return instanceWebClient.instance(instance)\n            .get()\n            .uri(customHealthPath)\n            .exchangeToMono(this::convertStatusInfo)\n            .timeout(getTimeoutWithMargin())\n            .onErrorResume(this::handleError)\n            .map(instance::withStatusInfo);\n    }\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Client Configuration"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"spring:\n  boot:\n    admin:\n      client:\n        instance:\n          metadata:\n            health-path: /custom/health\n"})}),"\n",(0,i.jsx)(n.h3,{id:"example-combine-multiple-health-checks",children:"Example: Combine Multiple Health Checks"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'package com.example.admin;\n\nimport java.util.Map;\n\nimport reactor.core.publisher.Mono;\n\nimport de.codecentric.boot.admin.server.domain.entities.Instance;\nimport de.codecentric.boot.admin.server.domain.entities.InstanceRepository;\nimport de.codecentric.boot.admin.server.domain.values.StatusInfo;\nimport de.codecentric.boot.admin.server.services.ApiMediaTypeHandler;\nimport de.codecentric.boot.admin.server.services.StatusUpdater;\nimport de.codecentric.boot.admin.server.web.client.InstanceWebClient;\n\npublic class AggregatedStatusUpdater extends StatusUpdater {\n\n    public AggregatedStatusUpdater(\n            InstanceRepository repository,\n            InstanceWebClient instanceWebClient,\n            ApiMediaTypeHandler apiMediaTypeHandler) {\n        super(repository, instanceWebClient, apiMediaTypeHandler);\n    }\n\n    @Override\n    protected Mono<Instance> doUpdateStatus(Instance instance) {\n        if (!instance.isRegistered()) {\n            return Mono.empty();\n        }\n\n        // Check both health and readiness\n        Mono<StatusInfo> health = instanceWebClient.instance(instance)\n            .get()\n            .uri("/actuator/health")\n            .exchangeToMono(this::convertStatusInfo)\n            .onErrorResume(ex -> Mono.just(StatusInfo.ofOffline()));\n\n        Mono<StatusInfo> readiness = instanceWebClient.instance(instance)\n            .get()\n            .uri("/actuator/health/readiness")\n            .exchangeToMono(this::convertStatusInfo)\n            .onErrorResume(ex -> Mono.just(StatusInfo.ofUp()));\n\n        return Mono.zip(health, readiness, this::combineStatus)\n            .map(instance::withStatusInfo);\n    }\n\n    private StatusInfo combineStatus(StatusInfo health, StatusInfo readiness) {\n        // If either is DOWN, overall is DOWN\n        if (health.isDown() || readiness.isDown()) {\n            return StatusInfo.ofDown(Map.of(\n                "health", health.getStatus(),\n                "readiness", readiness.getStatus()\n            ));\n        }\n\n        // If either is OFFLINE, overall is OFFLINE\n        if (health.isOffline() || readiness.isOffline()) {\n            return StatusInfo.ofOffline(Map.of(\n                "health", health.getStatus(),\n                "readiness", readiness.getStatus()\n            ));\n        }\n\n        // Otherwise UP\n        return StatusInfo.ofUp(Map.of(\n            "health", health.getStatus(),\n            "readiness", readiness.getStatus()\n        ));\n    }\n}\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"custom-infoupdater",children:"Custom InfoUpdater"}),"\n",(0,i.jsx)(n.h3,{id:"default-behavior-1",children:"Default Behavior"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"InfoUpdater"})," queries ",(0,i.jsx)(n.code,{children:"/actuator/info"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:"protected Mono<Instance> doUpdateInfo(Instance instance) {\n    if (instance.getStatusInfo().isOffline() || instance.getStatusInfo().isUnknown()) {\n        return Mono.empty();  // Skip if offline\n    }\n\n    if (!instance.getEndpoints().isPresent(Endpoint.INFO)) {\n        return Mono.empty();  // Skip if no info endpoint\n    }\n\n    return instanceWebClient.instance(instance)\n        .get()\n        .uri(Endpoint.INFO)\n        .exchangeToMono(response -> convertInfo(instance, response))\n        .onErrorResume(ex -> Mono.just(convertInfo(instance, ex)))\n        .map(instance::withInfo);\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"example-custom-info-endpoint",children:"Example: Custom Info Endpoint"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'package com.example.admin;\n\nimport reactor.core.publisher.Mono;\n\nimport de.codecentric.boot.admin.server.domain.entities.Instance;\nimport de.codecentric.boot.admin.server.domain.entities.InstanceRepository;\nimport de.codecentric.boot.admin.server.domain.values.Info;\nimport de.codecentric.boot.admin.server.services.ApiMediaTypeHandler;\nimport de.codecentric.boot.admin.server.services.InfoUpdater;\nimport de.codecentric.boot.admin.server.web.client.InstanceWebClient;\n\npublic class CustomInfoUpdater extends InfoUpdater {\n\n    public CustomInfoUpdater(\n            InstanceRepository repository,\n            InstanceWebClient instanceWebClient,\n            ApiMediaTypeHandler apiMediaTypeHandler) {\n        super(repository, instanceWebClient, apiMediaTypeHandler);\n    }\n\n    @Override\n    protected Mono<Instance> doUpdateInfo(Instance instance) {\n        if (instance.getStatusInfo().isOffline() || instance.getStatusInfo().isUnknown()) {\n            return Mono.empty();\n        }\n\n        // Query custom info endpoint\n        String infoPath = instance.getRegistration()\n            .getMetadata()\n            .getOrDefault("info-path", "/actuator/info");\n\n        return instanceWebClient.instance(instance)\n            .get()\n            .uri(infoPath)\n            .exchangeToMono(response -> convertInfo(instance, response))\n            .onErrorResume(ex -> Mono.just(Info.empty()))\n            .map(instance::withInfo);\n    }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"example-enrich-info-with-metadata",children:"Example: Enrich Info with Metadata"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'package com.example.admin;\n\nimport java.util.HashMap;\nimport java.util.Map;\n\nimport reactor.core.publisher.Mono;\nimport org.springframework.web.reactive.function.client.ClientResponse;\n\nimport de.codecentric.boot.admin.server.domain.entities.Instance;\nimport de.codecentric.boot.admin.server.domain.entities.InstanceRepository;\nimport de.codecentric.boot.admin.server.domain.values.Info;\nimport de.codecentric.boot.admin.server.services.ApiMediaTypeHandler;\nimport de.codecentric.boot.admin.server.services.InfoUpdater;\nimport de.codecentric.boot.admin.server.web.client.InstanceWebClient;\n\npublic class EnrichedInfoUpdater extends InfoUpdater {\n\n    public EnrichedInfoUpdater(\n            InstanceRepository repository,\n            InstanceWebClient instanceWebClient,\n            ApiMediaTypeHandler apiMediaTypeHandler) {\n        super(repository, instanceWebClient, apiMediaTypeHandler);\n    }\n\n    @Override\n    protected Mono<Info> convertInfo(Instance instance, ClientResponse response) {\n        return super.convertInfo(instance, response)\n            .map(info -> enrichInfo(instance, info));\n    }\n\n    private Info enrichInfo(Instance instance, Info originalInfo) {\n        Map<String, Object> enriched = new HashMap<>(originalInfo.getValues());\n\n        // Add metadata to info\n        enriched.put("metadata", instance.getRegistration().getMetadata());\n\n        // Add custom fields\n        enriched.put("registrationTime",\n            instance.getRegistration().getTimestamp().toString());\n\n        enriched.put("instanceId", instance.getId().getValue());\n\n        return Info.from(enriched);\n    }\n}\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"custom-status-codes",children:"Custom Status Codes"}),"\n",(0,i.jsx)(n.p,{children:"Define custom status codes for specific scenarios:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'package com.example.admin;\n\nimport java.util.Map;\n\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.http.HttpStatusCode;\n\nimport de.codecentric.boot.admin.server.domain.entities.InstanceRepository;\nimport de.codecentric.boot.admin.server.domain.values.StatusInfo;\nimport de.codecentric.boot.admin.server.services.ApiMediaTypeHandler;\nimport de.codecentric.boot.admin.server.services.StatusUpdater;\nimport de.codecentric.boot.admin.server.web.client.InstanceWebClient;\n\n@Configuration\npublic class CustomStatusConfig {\n\n    @Bean\n    public StatusUpdater statusUpdater(\n            InstanceRepository repository,\n            InstanceWebClient instanceWebClient,\n            ApiMediaTypeHandler apiMediaTypeHandler) {\n\n        return new CustomStatusCodeUpdater(repository, instanceWebClient, apiMediaTypeHandler);\n    }\n\n    static class CustomStatusCodeUpdater extends StatusUpdater {\n\n        public CustomStatusCodeUpdater(\n                InstanceRepository repository,\n                InstanceWebClient instanceWebClient,\n                ApiMediaTypeHandler apiMediaTypeHandler) {\n            super(repository, instanceWebClient, apiMediaTypeHandler);\n        }\n\n        @Override\n        protected StatusInfo getStatusInfoFromStatus(HttpStatusCode httpStatus, Map<String, ?> body) {\n            // Custom status codes\n            if (body.containsKey("status")) {\n                String status = body.get("status").toString();\n\n                return switch (status) {\n                    case "DEGRADED" -> StatusInfo.valueOf("DEGRADED",\n                        Map.of("details", "Service running with reduced capacity"));\n                    case "MAINTENANCE" -> StatusInfo.valueOf("OUT_OF_SERVICE",\n                        Map.of("reason", "Under maintenance"));\n                    case "WARMING_UP" -> StatusInfo.valueOf("RESTRICTED",\n                        Map.of("reason", "Service is warming up"));\n                    default -> super.getStatusInfoFromStatus(httpStatus, body);\n                };\n            }\n\n            return super.getStatusInfoFromStatus(httpStatus, body);\n        }\n    }\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Client Health Indicator"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'package com.example.client;\n\nimport org.springframework.boot.actuate.health.Health;\nimport org.springframework.boot.actuate.health.HealthIndicator;\nimport org.springframework.stereotype.Component;\n\n@Component\npublic class CustomHealthIndicator implements HealthIndicator {\n\n    private boolean warming = true;\n\n    @Override\n    public Health health() {\n        if (warming) {\n            return Health.status("WARMING_UP")\n                .withDetail("progress", "50%")\n                .build();\n        }\n\n        return Health.up().build();\n    }\n}\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"advanced-scenarios",children:"Advanced Scenarios"}),"\n",(0,i.jsx)(n.h3,{id:"scenario-1-external-health-check",children:"Scenario 1: External Health Check"}),"\n",(0,i.jsx)(n.p,{children:"Query an external monitoring service:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'package com.example.admin;\n\nimport org.springframework.web.reactive.function.client.WebClient;\nimport reactor.core.publisher.Mono;\n\nimport de.codecentric.boot.admin.server.domain.entities.Instance;\nimport de.codecentric.boot.admin.server.domain.entities.InstanceRepository;\nimport de.codecentric.boot.admin.server.domain.values.StatusInfo;\nimport de.codecentric.boot.admin.server.services.ApiMediaTypeHandler;\nimport de.codecentric.boot.admin.server.services.StatusUpdater;\nimport de.codecentric.boot.admin.server.web.client.InstanceWebClient;\n\npublic class ExternalHealthCheckStatusUpdater extends StatusUpdater {\n\n    private final WebClient externalMonitor;\n\n    public ExternalHealthCheckStatusUpdater(\n            InstanceRepository repository,\n            InstanceWebClient instanceWebClient,\n            ApiMediaTypeHandler apiMediaTypeHandler,\n            WebClient.Builder webClientBuilder) {\n        super(repository, instanceWebClient, apiMediaTypeHandler);\n        this.externalMonitor = webClientBuilder\n            .baseUrl("https://monitoring-service.company.com")\n            .build();\n    }\n\n    @Override\n    protected Mono<Instance> doUpdateStatus(Instance instance) {\n        String serviceName = instance.getRegistration().getName();\n\n        // Query external monitoring service\n        Mono<StatusInfo> externalStatus = externalMonitor.get()\n            .uri("/health/{service}", serviceName)\n            .retrieve()\n            .bodyToMono(ExternalHealthResponse.class)\n            .map(this::convertExternalHealth)\n            .onErrorResume(ex -> super.doUpdateStatus(instance)\n                .map(Instance::getStatusInfo));\n\n        return externalStatus.map(instance::withStatusInfo);\n    }\n\n    private StatusInfo convertExternalHealth(ExternalHealthResponse response) {\n        return StatusInfo.valueOf(response.getStatus(), response.getDetails());\n    }\n\n    record ExternalHealthResponse(String status, Map<String, Object> details) {\n        public String getStatus() { return status; }\n        public Map<String, Object> getDetails() { return details; }\n    }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"scenario-2-synthetic-monitoring",children:"Scenario 2: Synthetic Monitoring"}),"\n",(0,i.jsx)(n.p,{children:"Perform synthetic transactions:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'package com.example.admin;\n\nimport java.util.Map;\n\nimport reactor.core.publisher.Mono;\n\nimport de.codecentric.boot.admin.server.domain.entities.Instance;\nimport de.codecentric.boot.admin.server.domain.entities.InstanceRepository;\nimport de.codecentric.boot.admin.server.domain.values.StatusInfo;\nimport de.codecentric.boot.admin.server.services.ApiMediaTypeHandler;\nimport de.codecentric.boot.admin.server.services.StatusUpdater;\nimport de.codecentric.boot.admin.server.web.client.InstanceWebClient;\n\npublic class SyntheticMonitoringStatusUpdater extends StatusUpdater {\n\n    public SyntheticMonitoringStatusUpdater(\n            InstanceRepository repository,\n            InstanceWebClient instanceWebClient,\n            ApiMediaTypeHandler apiMediaTypeHandler) {\n        super(repository, instanceWebClient, apiMediaTypeHandler);\n    }\n\n    @Override\n    protected Mono<Instance> doUpdateStatus(Instance instance) {\n        // 1. Check health endpoint\n        Mono<StatusInfo> healthCheck = super.doUpdateStatus(instance)\n            .map(Instance::getStatusInfo);\n\n        // 2. Perform synthetic transaction\n        Mono<Boolean> syntheticCheck = performSyntheticTransaction(instance);\n\n        return Mono.zip(healthCheck, syntheticCheck,\n            (health, synthetic) -> {\n                if (health.isDown()) {\n                    return health;  // Already down\n                }\n\n                if (!synthetic) {\n                    return StatusInfo.valueOf("DEGRADED",\n                        Map.of("reason", "Synthetic transaction failed"));\n                }\n\n                return health;\n            })\n            .map(instance::withStatusInfo);\n    }\n\n    private Mono<Boolean> performSyntheticTransaction(Instance instance) {\n        // Example: Try to fetch a known endpoint\n        return instanceWebClient.instance(instance)\n            .get()\n            .uri("/api/health-check")\n            .retrieve()\n            .toBodilessEntity()\n            .map(response -> response.getStatusCode().is2xxSuccessful())\n            .onErrorReturn(false);\n    }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"scenario-3-database-backed-status",children:"Scenario 3: Database-Backed Status"}),"\n",(0,i.jsx)(n.p,{children:"Store and retrieve status from database:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:"package com.example.admin;\n\nimport reactor.core.publisher.Mono;\n\nimport de.codecentric.boot.admin.server.domain.entities.Instance;\nimport de.codecentric.boot.admin.server.domain.entities.InstanceRepository;\nimport de.codecentric.boot.admin.server.domain.values.StatusInfo;\nimport de.codecentric.boot.admin.server.services.ApiMediaTypeHandler;\nimport de.codecentric.boot.admin.server.services.StatusUpdater;\nimport de.codecentric.boot.admin.server.web.client.InstanceWebClient;\n\npublic class DatabaseBackedStatusUpdater extends StatusUpdater {\n\n    private final HealthStatusRepository healthStatusRepository;\n\n    public DatabaseBackedStatusUpdater(\n            InstanceRepository repository,\n            InstanceWebClient instanceWebClient,\n            ApiMediaTypeHandler apiMediaTypeHandler,\n            HealthStatusRepository healthStatusRepository) {\n        super(repository, instanceWebClient, apiMediaTypeHandler);\n        this.healthStatusRepository = healthStatusRepository;\n    }\n\n    @Override\n    protected Mono<Instance> doUpdateStatus(Instance instance) {\n        return super.doUpdateStatus(instance)\n            .flatMap(updatedInstance -> {\n                // Save status to database\n                HealthStatus status = new HealthStatus(\n                    instance.getId().getValue(),\n                    updatedInstance.getStatusInfo().getStatus(),\n                    updatedInstance.getStatusInfo().getDetails()\n                );\n\n                return healthStatusRepository.save(status)\n                    .thenReturn(updatedInstance);\n            });\n    }\n}\n\ninterface HealthStatusRepository {\n    Mono<HealthStatus> save(HealthStatus status);\n}\n\nrecord HealthStatus(String instanceId, String status, Map<String, Object> details) {}\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"debugging",children:"Debugging"}),"\n",(0,i.jsx)(n.h3,{id:"enable-debug-logging",children:"Enable Debug Logging"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"logging:\n  level:\n    de.codecentric.boot.admin.server.services.StatusUpdater: DEBUG\n    de.codecentric.boot.admin.server.services.InfoUpdater: DEBUG\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Log Output"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"DEBUG StatusUpdater - Update status for Instance{id=abc123, name=my-service}\nDEBUG StatusUpdater - Status updated: UP\n"})}),"\n",(0,i.jsx)(n.h3,{id:"monitor-status-updates",children:"Monitor Status Updates"}),"\n",(0,i.jsxs)(n.p,{children:["Listen to ",(0,i.jsx)(n.code,{children:"InstanceStatusChangedEvent"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'package com.example.admin;\n\nimport org.slf4j.Logger;\nimport org.slf4j.LoggerFactory;\nimport org.springframework.context.event.EventListener;\nimport org.springframework.stereotype.Component;\n\nimport de.codecentric.boot.admin.server.domain.events.InstanceStatusChangedEvent;\n\n@Component\npublic class StatusChangeLogger {\n\n    private static final Logger log = LoggerFactory.getLogger(StatusChangeLogger.class);\n\n    @EventListener\n    public void onStatusChanged(InstanceStatusChangedEvent event) {\n        log.info("Status changed for instance {}: {} -> {}",\n            event.getInstance(),\n            event.getStatusInfo().getStatus(),\n            event.getInstance().getStatusInfo().getStatus());\n    }\n}\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"complete-example",children:"Complete Example"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:'package com.example.admin;\n\nimport java.time.Duration;\nimport java.util.Map;\n\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.http.HttpStatusCode;\n\nimport de.codecentric.boot.admin.server.domain.entities.InstanceRepository;\nimport de.codecentric.boot.admin.server.domain.values.StatusInfo;\nimport de.codecentric.boot.admin.server.services.ApiMediaTypeHandler;\nimport de.codecentric.boot.admin.server.services.StatusUpdater;\nimport de.codecentric.boot.admin.server.web.client.InstanceWebClient;\n\n@Configuration\npublic class CustomMonitoringConfig {\n\n    @Bean\n    public StatusUpdater statusUpdater(\n            InstanceRepository repository,\n            InstanceWebClient instanceWebClient,\n            ApiMediaTypeHandler apiMediaTypeHandler) {\n\n        return new EnhancedStatusUpdater(repository, instanceWebClient, apiMediaTypeHandler)\n            .timeout(Duration.ofSeconds(15));\n    }\n\n    static class EnhancedStatusUpdater extends StatusUpdater {\n\n        public EnhancedStatusUpdater(\n                InstanceRepository repository,\n                InstanceWebClient instanceWebClient,\n                ApiMediaTypeHandler apiMediaTypeHandler) {\n            super(repository, instanceWebClient, apiMediaTypeHandler);\n        }\n\n        @Override\n        protected StatusInfo getStatusInfoFromStatus(HttpStatusCode httpStatus, Map<String, ?> body) {\n            // Support custom status codes\n            if (body.containsKey("status")) {\n                String status = body.get("status").toString().toUpperCase();\n\n                return switch (status) {\n                    case "DEGRADED" -> StatusInfo.valueOf("DEGRADED", body);\n                    case "MAINTENANCE" -> StatusInfo.valueOf("OUT_OF_SERVICE", body);\n                    case "STARTING" -> StatusInfo.valueOf("RESTRICTED",\n                        Map.of("reason", "Service starting"));\n                    default -> StatusInfo.valueOf(status, body);\n                };\n            }\n\n            // HTTP 503 = OUT_OF_SERVICE\n            if (httpStatus.value() == 503) {\n                return StatusInfo.valueOf("OUT_OF_SERVICE", body);\n            }\n\n            // HTTP 429 = RESTRICTED\n            if (httpStatus.value() == 429) {\n                return StatusInfo.valueOf("RESTRICTED",\n                    Map.of("reason", "Rate limited"));\n            }\n\n            return super.getStatusInfoFromStatus(httpStatus, body);\n        }\n    }\n}\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"see-also",children:"See Also"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/4.1.0-SNAPSHOT/docs/server/server",children:"Server Configuration"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/4.1.0-SNAPSHOT/docs/customization/monitoring/instance-filters",children:"Instance Filters"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://docs.spring.io/spring-boot/reference/actuator/endpoints.html#actuator.endpoints.health",children:"Spring Boot Actuator Health"})}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>o});var a=t(6540);const i={},s=a.createContext(i);function r(e){const n=a.useContext(s);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),a.createElement(s.Provider,{value:n},e.children)}}}]);