"use strict";(self.webpackChunksite=self.webpackChunksite||[]).push([[9541],{7136:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>c,default:()=>u,frontMatter:()=>i,metadata:()=>s,toc:()=>o});const s=JSON.parse('{"id":"security/actuator-security","title":"Actuator Security","description":"Secure your client application\'s actuator endpoints and configure Spring Boot Admin Server to access them.","source":"@site/docs/05-security/20-actuator-security.md","sourceDirName":"05-security","slug":"/security/actuator-security","permalink":"/4.0.0-SNAPSHOT/docs/security/actuator-security","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":20,"frontMatter":{"sidebar_position":20,"sidebar_custom_props":{"icon":"shield"}},"sidebar":"sidebar","previous":{"title":"Server Authentication","permalink":"/4.0.0-SNAPSHOT/docs/security/server-authentication"},"next":{"title":"CSRF Protection","permalink":"/4.0.0-SNAPSHOT/docs/security/csrf-protection"}}');var a=r(4848),t=r(8453);const i={sidebar_position:20,sidebar_custom_props:{icon:"shield"}},c="Actuator Security",l={},o=[{value:"Overview",id:"overview",level:2},{value:"Quick Start",id:"quick-start",level:2},{value:"1. Client: Secure Actuator Endpoints",id:"1-client-secure-actuator-endpoints",level:3},{value:"2. Client: Share Credentials with Admin Server",id:"2-client-share-credentials-with-admin-server",level:3},{value:"3. Server: Enable Instance Authentication",id:"3-server-enable-instance-authentication",level:3},{value:"Client Configuration",id:"client-configuration",level:2},{value:"Basic Actuator Security",id:"basic-actuator-security",level:3},{value:"Custom Security Configuration",id:"custom-security-configuration",level:3},{value:"Different Actuator and Application Security",id:"different-actuator-and-application-security",level:3},{value:"Actuator on Separate Port",id:"actuator-on-separate-port",level:3},{value:"Server Configuration",id:"server-configuration",level:2},{value:"Enable Instance Authentication",id:"enable-instance-authentication",level:3},{value:"Default Credentials",id:"default-credentials",level:3},{value:"Per-Service Credentials",id:"per-service-credentials",level:3},{value:"Credential Strategies",id:"credential-strategies",level:2},{value:"Strategy 1: Metadata (Recommended)",id:"strategy-1-metadata-recommended",level:3},{value:"Strategy 2: Server-Side Configuration",id:"strategy-2-server-side-configuration",level:3},{value:"Strategy 3: Default Credentials",id:"strategy-3-default-credentials",level:3},{value:"Limiting Exposed Endpoints",id:"limiting-exposed-endpoints",level:2},{value:"Metadata Sanitization",id:"metadata-sanitization",level:2},{value:"Service Discovery",id:"service-discovery",level:2},{value:"TLS/SSL for Actuator",id:"tlsssl-for-actuator",level:2},{value:"Examples",id:"examples",level:2},{value:"Example 1: Development (No Security)",id:"example-1-development-no-security",level:3},{value:"Example 2: Full Security Setup",id:"example-2-full-security-setup",level:3},{value:"Example 3: Kubernetes with Secrets",id:"example-3-kubernetes-with-secrets",level:3},{value:"Example 4: Multiple Environments",id:"example-4-multiple-environments",level:3},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Issue: 401 Unauthorized on actuator endpoints",id:"issue-401-unauthorized-on-actuator-endpoints",level:3},{value:"Issue: Admin Server shows &quot;Unavailable&quot;",id:"issue-admin-server-shows-unavailable",level:3},{value:"Issue: Some endpoints work, others return 401",id:"issue-some-endpoints-work-others-return-401",level:3},{value:"Issue: Metadata shows credentials in plain text",id:"issue-metadata-shows-credentials-in-plain-text",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"See Also",id:"see-also",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"actuator-security",children:"Actuator Security"})}),"\n",(0,a.jsx)(n.p,{children:"Secure your client application's actuator endpoints and configure Spring Boot Admin Server to access them."}),"\n",(0,a.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,a.jsx)(n.p,{children:"When client applications expose actuator endpoints, they should be secured. The Admin Server needs credentials to access\nthese secured endpoints."}),"\n",(0,a.jsx)(n.mermaid,{value:'graph TD\n    A["Spring Boot Admin Server<br/>Needs credentials to access<br/>secured actuator endpoints"] --\x3e|HTTP Basic Auth<br/>user.name + user.password| B["Client Application<br/>Secured actuator endpoints:<br/>/actuator/health<br/>/actuator/metrics<br/>/actuator/env"]'}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"quick-start",children:"Quick Start"}),"\n",(0,a.jsx)(n.h3,{id:"1-client-secure-actuator-endpoints",children:"1. Client: Secure Actuator Endpoints"}),"\n",(0,a.jsx)(n.p,{children:"Add Spring Security to your client application:"}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Maven"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-xml",children:"<dependency>\n    <groupId>org.springframework.boot</groupId>\n    <artifactId>spring-boot-starter-security</artifactId>\n</dependency>\n"})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Gradle"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-gradle",children:"implementation 'org.springframework.boot:spring-boot-starter-security'\n"})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"application.yml"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:'spring:\n  security:\n    user:\n      name: actuator\n      password: ${ACTUATOR_PASSWORD}\n\nmanagement:\n  endpoints:\n    web:\n      exposure:\n        include: "*"\n'})}),"\n",(0,a.jsx)(n.h3,{id:"2-client-share-credentials-with-admin-server",children:"2. Client: Share Credentials with Admin Server"}),"\n",(0,a.jsx)(n.p,{children:"Pass credentials via metadata:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"spring:\n  boot:\n    admin:\n      client:\n        url: http://admin-server:8080\n        instance:\n          metadata:\n            user.name: actuator\n            user.password: ${ACTUATOR_PASSWORD}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"3-server-enable-instance-authentication",children:"3. Server: Enable Instance Authentication"}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"application.yml"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"spring:\n  boot:\n    admin:\n      instance-auth:\n        enabled: true\n"})}),"\n",(0,a.jsx)(n.p,{children:"The Admin Server will automatically use credentials from instance metadata to access actuator endpoints."}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"client-configuration",children:"Client Configuration"}),"\n",(0,a.jsx)(n.h3,{id:"basic-actuator-security",children:"Basic Actuator Security"}),"\n",(0,a.jsx)(n.p,{children:"Simplest approach using default Spring Security user:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"spring:\n  application:\n    name: my-service\n\n  security:\n    user:\n      name: actuator\n      password: ${ACTUATOR_PASSWORD}\n\n  boot:\n    admin:\n      client:\n        url: http://admin-server:8080\n        instance:\n          metadata:\n            user.name: ${spring.security.user.name}\n            user.password: ${spring.security.user.password}\n\nmanagement:\n  endpoints:\n    web:\n      exposure:\n        include: health,info,metrics,env,loggers\n"})}),"\n",(0,a.jsx)(n.h3,{id:"custom-security-configuration",children:"Custom Security Configuration"}),"\n",(0,a.jsxs)(n.p,{children:["For more control, create a custom ",(0,a.jsx)(n.code,{children:"SecurityFilterChain"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'package com.example.myservice;\n\nimport org.springframework.boot.actuate.autoconfigure.security.servlet.EndpointRequest;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.security.config.Customizer;\nimport org.springframework.security.config.annotation.web.builders.HttpSecurity;\nimport org.springframework.security.core.userdetails.User;\nimport org.springframework.security.core.userdetails.UserDetails;\nimport org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;\nimport org.springframework.security.crypto.password.PasswordEncoder;\nimport org.springframework.security.provisioning.InMemoryUserDetailsManager;\nimport org.springframework.security.web.SecurityFilterChain;\n\n@Configuration\npublic class ActuatorSecurityConfig {\n\n    @Bean\n    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {\n        http\n            .authorizeHttpRequests(auth -> auth\n                // Permit health endpoint for load balancers\n                .requestMatchers(EndpointRequest.to("health")).permitAll()\n                // Secure all other actuator endpoints\n                .requestMatchers(EndpointRequest.toAnyEndpoint()).authenticated()\n                // Allow application endpoints\n                .anyRequest().permitAll()\n            )\n            // Use HTTP Basic for actuator\n            .httpBasic(Customizer.withDefaults())\n            // Disable CSRF for stateless API\n            .csrf(csrf -> csrf.disable());\n\n        return http.build();\n    }\n\n    @Bean\n    public InMemoryUserDetailsManager userDetailsService(PasswordEncoder encoder) {\n        UserDetails actuator = User.builder()\n            .username("actuator")\n            .password(encoder.encode(System.getenv("ACTUATOR_PASSWORD")))\n            .roles("ACTUATOR")\n            .build();\n\n        return new InMemoryUserDetailsManager(actuator);\n    }\n\n    @Bean\n    public PasswordEncoder passwordEncoder() {\n        return new BCryptPasswordEncoder();\n    }\n}\n'})}),"\n",(0,a.jsx)(n.h3,{id:"different-actuator-and-application-security",children:"Different Actuator and Application Security"}),"\n",(0,a.jsx)(n.p,{children:"Separate security for actuator and application:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'@Configuration\n@Order(1)  // Higher precedence\npublic class ActuatorSecurityConfig {\n\n    @Bean\n    @Order(1)\n    public SecurityFilterChain actuatorFilterChain(HttpSecurity http) throws Exception {\n        http\n            .securityMatcher(EndpointRequest.toAnyEndpoint())\n            .authorizeHttpRequests(auth -> auth\n                .requestMatchers(EndpointRequest.to("health")).permitAll()\n                .anyRequest().hasRole("ACTUATOR")\n            )\n            .httpBasic(Customizer.withDefaults())\n            .csrf(csrf -> csrf.disable());\n\n        return http.build();\n    }\n\n    @Bean\n    public InMemoryUserDetailsManager actuatorUserDetailsService(PasswordEncoder encoder) {\n        UserDetails actuator = User.builder()\n            .username("actuator")\n            .password(encoder.encode(System.getenv("ACTUATOR_PASSWORD")))\n            .roles("ACTUATOR")\n            .build();\n\n        return new InMemoryUserDetailsManager(actuator);\n    }\n}\n\n@Configuration\n@Order(2)  // Lower precedence\npublic class ApplicationSecurityConfig {\n\n    @Bean\n    @Order(2)\n    public SecurityFilterChain applicationFilterChain(HttpSecurity http) throws Exception {\n        http\n            .authorizeHttpRequests(auth -> auth\n                .requestMatchers("/api/public/**").permitAll()\n                .anyRequest().authenticated()\n            )\n            .oauth2Login(Customizer.withDefaults());\n\n        return http.build();\n    }\n}\n'})}),"\n",(0,a.jsx)(n.h3,{id:"actuator-on-separate-port",children:"Actuator on Separate Port"}),"\n",(0,a.jsx)(n.p,{children:"Run actuator on a different port for isolation:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:'management:\n  server:\n    port: 8081  # Separate management port\n  endpoints:\n    web:\n      exposure:\n        include: "*"\n\nspring:\n  security:\n    user:\n      name: actuator\n      password: ${ACTUATOR_PASSWORD}\n\n  boot:\n    admin:\n      client:\n        instance:\n          # Admin Server will auto-detect management port\n          # Or specify explicitly:\n          management-base-url: http://localhost:8081\n          metadata:\n            user.name: actuator\n            user.password: ${ACTUATOR_PASSWORD}\n'})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Security configuration"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:"@Configuration\npublic class SecurityConfig {\n\n    @Bean\n    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {\n        http\n            .authorizeHttpRequests(auth -> auth\n                // No actuator endpoints on main port\n                .anyRequest().permitAll()\n            )\n            .csrf(csrf -> csrf.disable());\n\n        return http.build();\n    }\n}\n"})}),"\n",(0,a.jsx)(n.p,{children:"On port 8081, actuator endpoints are secured with Spring Security's default security."}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"server-configuration",children:"Server Configuration"}),"\n",(0,a.jsx)(n.h3,{id:"enable-instance-authentication",children:"Enable Instance Authentication"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"spring:\n  boot:\n    admin:\n      instance-auth:\n        enabled: true\n"})}),"\n",(0,a.jsx)(n.p,{children:"Admin Server will:"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["Check instance metadata for ",(0,a.jsx)(n.code,{children:"user.name"})," and ",(0,a.jsx)(n.code,{children:"user.password"})]}),"\n",(0,a.jsx)(n.li,{children:"Use these credentials to access actuator endpoints via HTTP Basic"}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"default-credentials",children:"Default Credentials"}),"\n",(0,a.jsx)(n.p,{children:"Set default credentials for all instances:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"spring:\n  boot:\n    admin:\n      instance-auth:\n        enabled: true\n        default-user-name: actuator\n        default-password: ${DEFAULT_ACTUATOR_PASSWORD}\n"})}),"\n",(0,a.jsx)(n.p,{children:"Instances can override via metadata."}),"\n",(0,a.jsx)(n.h3,{id:"per-service-credentials",children:"Per-Service Credentials"}),"\n",(0,a.jsx)(n.p,{children:"Configure different credentials for each service:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"spring:\n  boot:\n    admin:\n      instance-auth:\n        enabled: true\n        service-map:\n          # Service name from spring.application.name\n          my-service:\n            user-name: my-service-actuator\n            user-password: ${MY_SERVICE_PASSWORD}\n          another-service:\n            user-name: another-actuator\n            user-password: ${ANOTHER_SERVICE_PASSWORD}\n\n        # Fallback for services not in service-map\n        default-user-name: default-actuator\n        default-password: ${DEFAULT_PASSWORD}\n"})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Client (my-service)"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"spring:\n  application:\n    name: my-service\n\n  security:\n    user:\n      name: my-service-actuator\n      password: ${MY_SERVICE_PASSWORD}\n"})}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"credential-strategies",children:"Credential Strategies"}),"\n",(0,a.jsx)(n.h3,{id:"strategy-1-metadata-recommended",children:"Strategy 1: Metadata (Recommended)"}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Client passes credentials in metadata"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"spring:\n  boot:\n    admin:\n      client:\n        instance:\n          metadata:\n            user.name: actuator\n            user.password: ${ACTUATOR_PASSWORD}\n"})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Server uses metadata automatically"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"spring:\n  boot:\n    admin:\n      instance-auth:\n        enabled: true\n"})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Pros"}),":"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Client controls its own credentials"}),"\n",(0,a.jsx)(n.li,{children:"Each instance can have unique credentials"}),"\n",(0,a.jsx)(n.li,{children:"Server automatically picks up credentials"}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Cons"}),":"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Credentials visible in instance metadata (sanitized by default)"}),"\n",(0,a.jsx)(n.li,{children:"Requires client configuration"}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"strategy-2-server-side-configuration",children:"Strategy 2: Server-Side Configuration"}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Server has all credentials"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"spring:\n  boot:\n    admin:\n      instance-auth:\n        enabled: true\n        service-map:\n          service-a:\n            user-name: service-a-user\n            user-password: ${SERVICE_A_PASSWORD}\n"})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Client just secures actuator"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"spring:\n  security:\n    user:\n      name: service-a-user\n      password: ${SERVICE_A_PASSWORD}\n"})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Pros"}),":"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Centralized credential management"}),"\n",(0,a.jsx)(n.li,{children:"Client configuration simpler"}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Cons"}),":"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Server must know all client credentials"}),"\n",(0,a.jsx)(n.li,{children:"Harder to scale with many services"}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"strategy-3-default-credentials",children:"Strategy 3: Default Credentials"}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"All clients use same credentials"}),":"]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Server"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"spring:\n  boot:\n    admin:\n      instance-auth:\n        enabled: true\n        default-user-name: actuator\n        default-password: ${ACTUATOR_PASSWORD}\n"})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"All Clients"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"spring:\n  security:\n    user:\n      name: actuator\n      password: ${ACTUATOR_PASSWORD}\n"})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Pros"}),":"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Simplest to configure"}),"\n",(0,a.jsx)(n.li,{children:"Uniform across all services"}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Cons"}),":"]}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Single credentials compromise affects all services"}),"\n",(0,a.jsx)(n.li,{children:"Less secure"}),"\n"]}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"limiting-exposed-endpoints",children:"Limiting Exposed Endpoints"}),"\n",(0,a.jsx)(n.p,{children:"Only expose necessary endpoints:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"management:\n  endpoints:\n    web:\n      exposure:\n        include: health,info,metrics,env,loggers\n"})}),"\n",(0,a.jsx)(n.p,{children:"Or exclude specific endpoints:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:'management:\n  endpoints:\n    web:\n      exposure:\n        include: "*"\n        exclude: heapdump,threaddump\n'})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Health endpoint details"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"management:\n  endpoint:\n    health:\n      show-details: when-authorized\n      roles: ACTUATOR\n"})}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"metadata-sanitization",children:"Metadata Sanitization"}),"\n",(0,a.jsx)(n.p,{children:"By default, credentials in metadata are sanitized:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:'spring:\n  boot:\n    admin:\n      metadata-keys-to-sanitize:\n        - ".*password$"\n        - ".*secret$"\n        - ".*key$"\n        - ".*token$"\n        - ".*credentials.*"\n'})}),"\n",(0,a.jsxs)(n.p,{children:["Metadata ",(0,a.jsx)(n.code,{children:"user.password"})," will appear as ",(0,a.jsx)(n.code,{children:"******"})," in responses, but the server still uses it internally."]}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"service-discovery",children:"Service Discovery"}),"\n",(0,a.jsx)(n.p,{children:"When using service discovery (Eureka, Consul, etc.), credentials can be set via metadata:"}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Eureka"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"eureka:\n  instance:\n    metadata-map:\n      user.name: actuator\n      user.password: ${ACTUATOR_PASSWORD}\n"})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Consul"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"spring:\n  cloud:\n    consul:\n      discovery:\n        metadata:\n          user.name: actuator\n          user.password: ${ACTUATOR_PASSWORD}\n"})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Kubernetes ConfigMap"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"apiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: my-service-config\ndata:\n  application.yml: |\n    spring:\n      boot:\n        admin:\n          client:\n            instance:\n              metadata:\n                user.name: actuator\n                user.password: ${ACTUATOR_PASSWORD}\n"})}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"tlsssl-for-actuator",children:"TLS/SSL for Actuator"}),"\n",(0,a.jsx)(n.p,{children:"Use HTTPS for actuator endpoints:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"management:\n  server:\n    port: 8443\n    ssl:\n      enabled: true\n      key-store: classpath:actuator-keystore.p12\n      key-store-password: ${KEYSTORE_PASSWORD}\n      key-store-type: PKCS12\n\nspring:\n  boot:\n    admin:\n      client:\n        instance:\n          management-base-url: https://localhost:8443\n          metadata:\n            user.name: actuator\n            user.password: ${ACTUATOR_PASSWORD}\n"})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Generate keystore"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"keytool -genkeypair -alias actuator \\\n  -keyalg RSA -keysize 2048 \\\n  -storetype PKCS12 \\\n  -keystore actuator-keystore.p12 \\\n  -validity 3650 \\\n  -storepass changeit\n"})}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"examples",children:"Examples"}),"\n",(0,a.jsx)(n.h3,{id:"example-1-development-no-security",children:"Example 1: Development (No Security)"}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Client"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:'management:\n  endpoints:\n    web:\n      exposure:\n        include: "*"\n\nspring:\n  boot:\n    admin:\n      client:\n        url: http://localhost:8080\n'})}),"\n",(0,a.jsx)(n.p,{children:"No Spring Security dependency, all endpoints open."}),"\n",(0,a.jsx)(n.h3,{id:"example-2-full-security-setup",children:"Example 2: Full Security Setup"}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Client"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"spring:\n  application:\n    name: payment-service\n\n  security:\n    user:\n      name: ${ACTUATOR_USER}\n      password: ${ACTUATOR_PASSWORD}\n\n  boot:\n    admin:\n      client:\n        url: https://admin.company.com\n        username: ${ADMIN_CLIENT_USER}\n        password: ${ADMIN_CLIENT_PASSWORD}\n        instance:\n          service-base-url: https://payment.company.com\n          management-base-url: https://payment.company.com:8443\n          metadata:\n            user.name: ${ACTUATOR_USER}\n            user.password: ${ACTUATOR_PASSWORD}\n            tags:\n              environment: production\n\nmanagement:\n  server:\n    port: 8443\n    ssl:\n      enabled: true\n      key-store: classpath:keystore.p12\n      key-store-password: ${KEYSTORE_PASSWORD}\n\n  endpoints:\n    web:\n      exposure:\n        include: health,info,metrics,env,loggers\n\n  endpoint:\n    health:\n      show-details: when-authorized\n"})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Server"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"spring:\n  boot:\n    admin:\n      instance-auth:\n        enabled: true\n        # Uses credentials from instance metadata\n"})}),"\n",(0,a.jsx)(n.h3,{id:"example-3-kubernetes-with-secrets",children:"Example 3: Kubernetes with Secrets"}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Secret"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"apiVersion: v1\nkind: Secret\nmetadata:\n  name: actuator-credentials\ntype: Opaque\nstringData:\n  username: actuator\n  password: secure-password-123\n"})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Deployment"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: my-service\nspec:\n  template:\n    spec:\n      containers:\n        - name: my-service\n          image: my-service:latest\n          env:\n            - name: ACTUATOR_USER\n              valueFrom:\n                secretKeyRef:\n                  name: actuator-credentials\n                  key: username\n            - name: ACTUATOR_PASSWORD\n              valueFrom:\n                secretKeyRef:\n                  name: actuator-credentials\n                  key: password\n          ports:\n            - containerPort: 8080\n            - containerPort: 8081  # Actuator\n"})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"application.yml"})," (in ConfigMap):"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"spring:\n  security:\n    user:\n      name: ${ACTUATOR_USER}\n      password: ${ACTUATOR_PASSWORD}\n\n  boot:\n    admin:\n      client:\n        instance:\n          metadata:\n            user.name: ${ACTUATOR_USER}\n            user.password: ${ACTUATOR_PASSWORD}\n\nmanagement:\n  server:\n    port: 8081\n"})}),"\n",(0,a.jsx)(n.h3,{id:"example-4-multiple-environments",children:"Example 4: Multiple Environments"}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"application.yml"})," (common):"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:'spring:\n  boot:\n    admin:\n      client:\n        instance:\n          metadata:\n            user.name: ${ACTUATOR_USER:actuator}\n            user.password: ${ACTUATOR_PASSWORD}\n\nmanagement:\n  endpoints:\n    web:\n      exposure:\n        include: "*"\n'})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"application-dev.yml"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"spring:\n  security:\n    user:\n      name: actuator\n      password: dev-password\n\n  boot:\n    admin:\n      client:\n        url: http://localhost:8080\n"})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"application-prod.yml"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"spring:\n  security:\n    user:\n      name: ${ACTUATOR_USER}\n      password: ${ACTUATOR_PASSWORD}\n\n  boot:\n    admin:\n      client:\n        url: https://admin.company.com\n        username: ${ADMIN_CLIENT_USER}\n        password: ${ADMIN_CLIENT_PASSWORD}\n\nmanagement:\n  endpoints:\n    web:\n      exposure:\n        include: health,info,metrics,env,loggers\n  endpoint:\n    health:\n      show-details: when-authorized\n"})}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,a.jsx)(n.h3,{id:"issue-401-unauthorized-on-actuator-endpoints",children:"Issue: 401 Unauthorized on actuator endpoints"}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Cause"}),": Admin Server doesn't have valid credentials."]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Check"}),":"]}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:"Instance metadata contains credentials:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"curl http://admin-server:8080/instances/{id} | jq '.metadata'\n"})}),"\n"]}),"\n",(0,a.jsxs)(n.li,{children:["\n",(0,a.jsx)(n.p,{children:"Credentials match actuator configuration:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"curl -u actuator:password http://client:8080/actuator/health\n"})}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Solution"}),": Add credentials to metadata:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"spring:\n  boot:\n    admin:\n      client:\n        instance:\n          metadata:\n            user.name: actuator\n            user.password: ${ACTUATOR_PASSWORD}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"issue-admin-server-shows-unavailable",children:'Issue: Admin Server shows "Unavailable"'}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Cause"}),": Cannot access health endpoint."]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Check"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"curl -u actuator:password http://client:8080/actuator/health\n"})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Solution"}),": Verify:"]}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:"Health endpoint is exposed"}),"\n",(0,a.jsx)(n.li,{children:"Credentials are correct"}),"\n",(0,a.jsx)(n.li,{children:"Health URL is accessible from Admin Server"}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"issue-some-endpoints-work-others-return-401",children:"Issue: Some endpoints work, others return 401"}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Cause"}),": Different security rules for different endpoints."]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Solution"}),": Ensure all actuator endpoints have same security:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:"http.authorizeHttpRequests(auth -> auth\n    .requestMatchers(EndpointRequest.toAnyEndpoint()).authenticated()\n)\n"})}),"\n",(0,a.jsx)(n.h3,{id:"issue-metadata-shows-credentials-in-plain-text",children:"Issue: Metadata shows credentials in plain text"}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Expected"}),": Credentials should be sanitized as ",(0,a.jsx)(n.code,{children:"******"}),"."]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"Check sanitization patterns"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:'spring:\n  boot:\n    admin:\n      metadata-keys-to-sanitize:\n        - ".*password$"\n'})}),"\n",(0,a.jsxs)(n.p,{children:["This is working correctly if API responses show ",(0,a.jsx)(n.code,{children:"******"})," for ",(0,a.jsx)(n.code,{children:"user.password"}),", even though the server uses the real value\ninternally."]}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Use Strong Passwords"}),": Generate secure random passwords"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Environment Variables"}),": Never hardcode credentials"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Limit Exposure"}),": Only expose necessary actuator endpoints"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Use HTTPS"}),": Encrypt actuator traffic with TLS"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Separate Port"}),": Consider separate management port for isolation"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Role-Based Access"}),": Use roles for fine-grained control"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Monitor Access"}),": Log actuator access attempts"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Rotate Credentials"}),": Regularly update actuator passwords"]}),"\n"]}),"\n",(0,a.jsx)(n.hr,{}),"\n",(0,a.jsx)(n.h2,{id:"see-also",children:"See Also"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"/4.0.0-SNAPSHOT/docs/security/server-authentication",children:"Server Authentication"})," - Secure Admin Server"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"/4.0.0-SNAPSHOT/docs/security/csrf-protection",children:"CSRF Protection"})," - Configure CSRF tokens"]}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>i,x:()=>c});var s=r(6540);const a={},t=s.createContext(a);function i(e){const n=s.useContext(t);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:i(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);