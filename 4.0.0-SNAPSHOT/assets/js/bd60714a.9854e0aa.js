"use strict";(self.webpackChunksite=self.webpackChunksite||[]).push([[9610],{8907:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>u,frontMatter:()=>a,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"security/server-authentication","title":"Server Authentication","description":"Secure your Spring Boot Admin Server using Spring Security to protect the UI and API endpoints.","source":"@site/docs/05-security/10-server-authentication.md","sourceDirName":"05-security","slug":"/security/server-authentication","permalink":"/4.0.0-SNAPSHOT/docs/security/server-authentication","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":10,"frontMatter":{"sidebar_position":10,"sidebar_custom_props":{"icon":"shield"}},"sidebar":"sidebar","previous":{"title":"Security","permalink":"/4.0.0-SNAPSHOT/docs/security/"},"next":{"title":"Actuator Security","permalink":"/4.0.0-SNAPSHOT/docs/security/actuator-security"}}');var s=r(4848),i=r(8453);const a={sidebar_position:10,sidebar_custom_props:{icon:"shield"}},o="Server Authentication",c={},l=[{value:"Overview",id:"overview",level:2},{value:"Quick Start",id:"quick-start",level:2},{value:"1. Add Spring Security Dependency",id:"1-add-spring-security-dependency",level:3},{value:"2. Basic Configuration",id:"2-basic-configuration",level:3},{value:"3. Access the UI",id:"3-access-the-ui",level:3},{value:"Complete Security Configuration",id:"complete-security-configuration",level:2},{value:"Custom CSRF Filter",id:"custom-csrf-filter",level:3},{value:"Configuration Options",id:"configuration-options",level:2},{value:"Context Path",id:"context-path",level:3},{value:"Remember-Me",id:"remember-me",level:3},{value:"Session Management",id:"session-management",level:3},{value:"User Management",id:"user-management",level:2},{value:"In-Memory Users",id:"in-memory-users",level:3},{value:"Database Users",id:"database-users",level:3},{value:"LDAP Authentication",id:"ldap-authentication",level:3},{value:"OAuth2 / OIDC",id:"oauth2--oidc",level:3},{value:"Role-Based Access Control",id:"role-based-access-control",level:2},{value:"HTTP vs HTTPS",id:"http-vs-https",level:2},{value:"Local Development (HTTP)",id:"local-development-http",level:3},{value:"HTTPS Configuration",id:"https-configuration",level:3},{value:"Reverse Proxy Setup",id:"reverse-proxy-setup",level:2},{value:"Behind Nginx",id:"behind-nginx",level:3},{value:"Behind Apache",id:"behind-apache",level:3},{value:"Security Headers",id:"security-headers",level:2},{value:"Multiple Authentication Methods",id:"multiple-authentication-methods",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Issue: Login page not loading",id:"issue-login-page-not-loading",level:3},{value:"Issue: Infinite redirect loop",id:"issue-infinite-redirect-loop",level:3},{value:"Issue: Clients cannot register",id:"issue-clients-cannot-register",level:3},{value:"Issue: Remember-me not working",id:"issue-remember-me-not-working",level:3},{value:"Issue: 401 on API requests",id:"issue-401-on-api-requests",level:3},{value:"Complete Example",id:"complete-example",level:2},{value:"See Also",id:"see-also",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"server-authentication",children:"Server Authentication"})}),"\n",(0,s.jsx)(n.p,{children:"Secure your Spring Boot Admin Server using Spring Security to protect the UI and API endpoints."}),"\n",(0,s.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,s.jsx)(n.p,{children:"A secured Admin Server requires:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.strong,{children:"Spring Security dependency"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.strong,{children:"SecurityFilterChain configuration"})}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"User credentials"})," (in-memory, database, LDAP, OAuth2, etc.)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"CSRF protection"})," with exemptions for client registration"]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"quick-start",children:"Quick Start"}),"\n",(0,s.jsx)(n.h3,{id:"1-add-spring-security-dependency",children:"1. Add Spring Security Dependency"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Maven"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-xml",children:"<dependency>\n    <groupId>org.springframework.boot</groupId>\n    <artifactId>spring-boot-starter-security</artifactId>\n</dependency>\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Gradle"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-gradle",children:"implementation 'org.springframework.boot:spring-boot-starter-security'\n"})}),"\n",(0,s.jsx)(n.h3,{id:"2-basic-configuration",children:"2. Basic Configuration"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Minimal security"})," with default Spring Boot user:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"spring:\n  security:\n    user:\n      name: admin\n      password: ${ADMIN_PASSWORD}\n"})}),"\n",(0,s.jsx)(n.p,{children:"This provides:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Form login at ",(0,s.jsx)(n.code,{children:"/login"})]}),"\n",(0,s.jsx)(n.li,{children:"HTTP Basic authentication for API"}),"\n",(0,s.jsxs)(n.li,{children:["Single user with username ",(0,s.jsx)(n.code,{children:"admin"})]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"3-access-the-ui",children:"3. Access the UI"}),"\n",(0,s.jsxs)(n.p,{children:["Navigate to ",(0,s.jsx)(n.code,{children:"http://localhost:8080"}),", and you'll be redirected to the login page."]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"complete-security-configuration",children:"Complete Security Configuration"}),"\n",(0,s.jsxs)(n.p,{children:["For more control, use a custom ",(0,s.jsx)(n.code,{children:"SecurityFilterChain"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'package com.example.admin;\n\nimport java.util.UUID;\n\nimport org.springframework.boot.autoconfigure.security.SecurityProperties;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.security.config.Customizer;\nimport org.springframework.security.config.annotation.web.builders.HttpSecurity;\nimport org.springframework.security.core.userdetails.User;\nimport org.springframework.security.core.userdetails.UserDetails;\nimport org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;\nimport org.springframework.security.crypto.password.PasswordEncoder;\nimport org.springframework.security.provisioning.InMemoryUserDetailsManager;\nimport org.springframework.security.web.SecurityFilterChain;\nimport org.springframework.security.web.authentication.SavedRequestAwareAuthenticationSuccessHandler;\nimport org.springframework.security.web.authentication.www.BasicAuthenticationFilter;\nimport org.springframework.security.web.csrf.CookieCsrfTokenRepository;\nimport org.springframework.security.web.csrf.CsrfTokenRequestAttributeHandler;\nimport org.springframework.security.web.servlet.util.matcher.PathPatternRequestMatcher;\n\nimport de.codecentric.boot.admin.server.config.AdminServerProperties;\n\nimport static org.springframework.http.HttpMethod.DELETE;\nimport static org.springframework.http.HttpMethod.POST;\n\n@Configuration\npublic class SecurityConfig {\n\n    private final AdminServerProperties adminServer;\n\n    public SecurityConfig(AdminServerProperties adminServer) {\n        this.adminServer = adminServer;\n    }\n\n    @Bean\n    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {\n        // Redirect to login after successful authentication\n        SavedRequestAwareAuthenticationSuccessHandler successHandler =\n            new SavedRequestAwareAuthenticationSuccessHandler();\n        successHandler.setTargetUrlParameter("redirectTo");\n        successHandler.setDefaultTargetUrl(adminServer.path("/"));\n\n        http\n            .authorizeHttpRequests(auth -> auth\n                // Permit access to static resources\n                .requestMatchers(PathPatternRequestMatcher.withDefaults()\n                    .matcher(adminServer.path("/assets/**")))\n                .permitAll()\n                // Permit access to login page\n                .requestMatchers(PathPatternRequestMatcher.withDefaults()\n                    .matcher(adminServer.path("/login")))\n                .permitAll()\n                // Permit Admin Server\'s own actuator endpoints\n                .requestMatchers(PathPatternRequestMatcher.withDefaults()\n                    .matcher(adminServer.path("/actuator/info")))\n                .permitAll()\n                .requestMatchers(PathPatternRequestMatcher.withDefaults()\n                    .matcher(adminServer.path("/actuator/health")))\n                .permitAll()\n                // Require authentication for all other requests\n                .anyRequest().authenticated()\n            )\n            // Form login for UI\n            .formLogin(formLogin -> formLogin\n                .loginPage(adminServer.path("/login"))\n                .successHandler(successHandler)\n            )\n            // Logout configuration\n            .logout(logout -> logout\n                .logoutUrl(adminServer.path("/logout"))\n            )\n            // HTTP Basic for API clients\n            .httpBasic(Customizer.withDefaults());\n\n        // CSRF configuration (see CSRF Protection section)\n        http.addFilterAfter(new CustomCsrfFilter(), BasicAuthenticationFilter.class)\n            .csrf(csrf -> csrf\n                .csrfTokenRepository(CookieCsrfTokenRepository.withHttpOnlyFalse())\n                .csrfTokenRequestHandler(new CsrfTokenRequestAttributeHandler())\n                .ignoringRequestMatchers(\n                    // Exempt client registration endpoints\n                    PathPatternRequestMatcher.withDefaults()\n                        .matcher(POST, adminServer.path("/instances")),\n                    PathPatternRequestMatcher.withDefaults()\n                        .matcher(DELETE, adminServer.path("/instances/*")),\n                    // Exempt Admin Server\'s own actuator\n                    PathPatternRequestMatcher.withDefaults()\n                        .matcher(adminServer.path("/actuator/**"))\n                )\n            );\n\n        // Remember-me functionality\n        http.rememberMe(rememberMe -> rememberMe\n            .key(UUID.randomUUID().toString())\n            .tokenValiditySeconds(1209600) // 2 weeks\n        );\n\n        return http.build();\n    }\n\n    @Bean\n    public InMemoryUserDetailsManager userDetailsService(PasswordEncoder passwordEncoder) {\n        UserDetails user = User.builder()\n            .username("admin")\n            .password(passwordEncoder.encode(System.getenv("ADMIN_PASSWORD")))\n            .roles("ADMIN")\n            .build();\n\n        return new InMemoryUserDetailsManager(user);\n    }\n\n    @Bean\n    public PasswordEncoder passwordEncoder() {\n        return new BCryptPasswordEncoder();\n    }\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"custom-csrf-filter",children:"Custom CSRF Filter"}),"\n",(0,s.jsx)(n.p,{children:"Required to make CSRF token available to JavaScript:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'package com.example.admin;\n\nimport java.io.IOException;\n\nimport jakarta.servlet.FilterChain;\nimport jakarta.servlet.ServletException;\nimport jakarta.servlet.http.Cookie;\nimport jakarta.servlet.http.HttpServletRequest;\nimport jakarta.servlet.http.HttpServletResponse;\nimport org.springframework.security.web.csrf.CsrfToken;\nimport org.springframework.web.filter.OncePerRequestFilter;\nimport org.springframework.web.util.WebUtils;\n\npublic class CustomCsrfFilter extends OncePerRequestFilter {\n\n    public static final String CSRF_COOKIE_NAME = "XSRF-TOKEN";\n\n    @Override\n    protected void doFilterInternal(HttpServletRequest request,\n                                    HttpServletResponse response,\n                                    FilterChain filterChain)\n            throws ServletException, IOException {\n\n        CsrfToken csrf = (CsrfToken) request.getAttribute(CsrfToken.class.getName());\n\n        if (csrf != null) {\n            Cookie cookie = WebUtils.getCookie(request, CSRF_COOKIE_NAME);\n            String token = csrf.getToken();\n\n            if (cookie == null || token != null && !token.equals(cookie.getValue())) {\n                cookie = new Cookie(CSRF_COOKIE_NAME, token);\n                cookie.setPath("/");\n                response.addCookie(cookie);\n            }\n        }\n\n        filterChain.doFilter(request, response);\n    }\n}\n'})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"configuration-options",children:"Configuration Options"}),"\n",(0,s.jsx)(n.h3,{id:"context-path",children:"Context Path"}),"\n",(0,s.jsx)(n.p,{children:"If your Admin Server uses a custom context path:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"spring:\n  boot:\n    admin:\n      context-path: /admin\n"})}),"\n",(0,s.jsx)(n.p,{children:"Adjust security matchers:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'.requestMatchers(PathPatternRequestMatcher.withDefaults()\n    .matcher(adminServer.path("/assets/**")))\n.permitAll()\n'})}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.code,{children:"adminServer.path()"})," method handles context path automatically."]}),"\n",(0,s.jsx)(n.h3,{id:"remember-me",children:"Remember-Me"}),"\n",(0,s.jsx)(n.p,{children:"Enable persistent sessions:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'http.rememberMe(rememberMe -> rememberMe\n    .key(UUID.randomUUID().toString())           // Unique key\n    .tokenValiditySeconds(1209600)               // 2 weeks\n    .rememberMeParameter("remember-me")          // Form parameter name\n)\n'})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Note"}),": Remember-me requires a ",(0,s.jsx)(n.code,{children:"UserDetailsService"})," bean."]}),"\n",(0,s.jsx)(n.h3,{id:"session-management",children:"Session Management"}),"\n",(0,s.jsx)(n.p,{children:"Configure session behavior:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:"http.sessionManagement(session -> session\n    .sessionCreationPolicy(SessionCreationPolicy.IF_REQUIRED)\n    .maximumSessions(1)                          // Max 1 session per user\n    .maxSessionsPreventsLogin(false)             // Invalidate old session\n)\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"user-management",children:"User Management"}),"\n",(0,s.jsx)(n.h3,{id:"in-memory-users",children:"In-Memory Users"}),"\n",(0,s.jsx)(n.p,{children:"Simple for development or small deployments:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'@Bean\npublic InMemoryUserDetailsManager userDetailsService(PasswordEncoder encoder) {\n    UserDetails admin = User.builder()\n        .username("admin")\n        .password(encoder.encode(System.getenv("ADMIN_PASSWORD")))\n        .roles("ADMIN")\n        .build();\n\n    UserDetails viewer = User.builder()\n        .username("viewer")\n        .password(encoder.encode(System.getenv("VIEWER_PASSWORD")))\n        .roles("USER")\n        .build();\n\n    return new InMemoryUserDetailsManager(admin, viewer);\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"database-users",children:"Database Users"}),"\n",(0,s.jsxs)(n.p,{children:["Use ",(0,s.jsx)(n.code,{children:"JdbcUserDetailsManager"})," for database-backed users:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'@Bean\npublic JdbcUserDetailsManager userDetailsService(DataSource dataSource,\n                                                  PasswordEncoder encoder) {\n    JdbcUserDetailsManager manager = new JdbcUserDetailsManager(dataSource);\n\n    // Create default admin if not exists\n    if (!manager.userExists("admin")) {\n        UserDetails admin = User.builder()\n            .username("admin")\n            .password(encoder.encode(System.getenv("ADMIN_PASSWORD")))\n            .roles("ADMIN")\n            .build();\n        manager.createUser(admin);\n    }\n\n    return manager;\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Database Schema"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-sql",children:"CREATE TABLE users (\n    username VARCHAR(50) NOT NULL PRIMARY KEY,\n    password VARCHAR(100) NOT NULL,\n    enabled BOOLEAN NOT NULL\n);\n\nCREATE TABLE authorities (\n    username VARCHAR(50) NOT NULL,\n    authority VARCHAR(50) NOT NULL,\n    FOREIGN KEY (username) REFERENCES users(username)\n);\n\nCREATE UNIQUE INDEX ix_auth_username ON authorities (username, authority);\n"})}),"\n",(0,s.jsx)(n.h3,{id:"ldap-authentication",children:"LDAP Authentication"}),"\n",(0,s.jsx)(n.p,{children:"Authenticate against an LDAP server:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'@Bean\npublic SecurityFilterChain filterChain(HttpSecurity http,\n                                       AdminServerProperties adminServer) throws Exception {\n    http\n        .authorizeHttpRequests(/* ... */)\n        .formLogin(/* ... */)\n        .logout(/* ... */)\n        .httpBasic(Customizer.withDefaults());\n\n    return http.build();\n}\n\n@Configuration\npublic static class LdapConfig {\n\n    @Bean\n    public EmbeddedLdapServerContextSourceFactoryBean contextSourceFactoryBean() {\n        EmbeddedLdapServerContextSourceFactoryBean factory =\n            new EmbeddedLdapServerContextSourceFactoryBean();\n        factory.setPort(8389);\n        return factory;\n    }\n\n    @Bean\n    public AuthenticationManager authenticationManager(BaseLdapPathContextSource contextSource) {\n        LdapBindAuthenticationManagerFactory factory =\n            new LdapBindAuthenticationManagerFactory(contextSource);\n        factory.setUserDnPatterns("uid={0},ou=people");\n        factory.setUserDetailsContextMapper(new PersonContextMapper());\n        return factory.createAuthenticationManager();\n    }\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Configuration"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"spring:\n  ldap:\n    urls: ldap://ldap.company.com:389\n    base: dc=company,dc=com\n    username: cn=admin,dc=company,dc=com\n    password: ${LDAP_PASSWORD}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"oauth2--oidc",children:"OAuth2 / OIDC"}),"\n",(0,s.jsx)(n.p,{children:"Use OAuth2 for Single Sign-On (SSO):"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Dependencies"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-xml",children:"<dependency>\n    <groupId>org.springframework.boot</groupId>\n    <artifactId>spring-boot-starter-oauth2-client</artifactId>\n</dependency>\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Configuration"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'spring:\n  security:\n    oauth2:\n      client:\n        registration:\n          keycloak:\n            client-id: spring-boot-admin\n            client-secret: ${OAUTH2_CLIENT_SECRET}\n            scope: openid,profile,email\n            authorization-grant-type: authorization_code\n            redirect-uri: "{baseUrl}/login/oauth2/code/{registrationId}"\n        provider:\n          keycloak:\n            issuer-uri: https://keycloak.company.com/realms/main\n'})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Security Configuration"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'@Bean\npublic SecurityFilterChain filterChain(HttpSecurity http,\n                                       AdminServerProperties adminServer) throws Exception {\n    http\n        .authorizeHttpRequests(auth -> auth\n            .requestMatchers(PathPatternRequestMatcher.withDefaults()\n                .matcher(adminServer.path("/assets/**")))\n            .permitAll()\n            .requestMatchers(PathPatternRequestMatcher.withDefaults()\n                .matcher(adminServer.path("/login")))\n            .permitAll()\n            .anyRequest().authenticated()\n        )\n        .oauth2Login(oauth2 -> oauth2\n            .loginPage(adminServer.path("/login"))\n        )\n        .logout(logout -> logout\n            .logoutUrl(adminServer.path("/logout"))\n            .logoutSuccessUrl(adminServer.path("/"))\n        );\n\n    // CSRF and other configurations...\n\n    return http.build();\n}\n'})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"role-based-access-control",children:"Role-Based Access Control"}),"\n",(0,s.jsx)(n.p,{children:"Restrict access by roles:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'@Bean\npublic SecurityFilterChain filterChain(HttpSecurity http,\n                                       AdminServerProperties adminServer) throws Exception {\n    http.authorizeHttpRequests(auth -> auth\n            .requestMatchers(PathPatternRequestMatcher.withDefaults()\n                .matcher(adminServer.path("/assets/**")))\n            .permitAll()\n            .requestMatchers(PathPatternRequestMatcher.withDefaults()\n                .matcher(adminServer.path("/login")))\n            .permitAll()\n            // Only ADMIN can delete instances\n            .requestMatchers(PathPatternRequestMatcher.withDefaults()\n                .matcher(DELETE, adminServer.path("/instances/*")))\n            .hasRole("ADMIN")\n            // Only ADMIN can access logfile endpoint\n            .requestMatchers(PathPatternRequestMatcher.withDefaults()\n                .matcher(adminServer.path("/instances/*/actuator/logfile")))\n            .hasRole("ADMIN")\n            // USER and ADMIN can view everything else\n            .anyRequest().hasAnyRole("USER", "ADMIN")\n        )\n        .formLogin(formLogin -> formLogin.loginPage(adminServer.path("/login")))\n        .httpBasic(Customizer.withDefaults());\n\n    return http.build();\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Create users with different roles"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'@Bean\npublic InMemoryUserDetailsManager userDetailsService(PasswordEncoder encoder) {\n    UserDetails admin = User.builder()\n        .username("admin")\n        .password(encoder.encode(System.getenv("ADMIN_PASSWORD")))\n        .roles("ADMIN")\n        .build();\n\n    UserDetails viewer = User.builder()\n        .username("viewer")\n        .password(encoder.encode(System.getenv("VIEWER_PASSWORD")))\n        .roles("USER")\n        .build();\n\n    return new InMemoryUserDetailsManager(admin, viewer);\n}\n'})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"http-vs-https",children:"HTTP vs HTTPS"}),"\n",(0,s.jsx)(n.h3,{id:"local-development-http",children:"Local Development (HTTP)"}),"\n",(0,s.jsx)(n.p,{children:"For local development, HTTP is acceptable:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"server:\n  port: 8080\n"})}),"\n",(0,s.jsx)(n.h3,{id:"https-configuration",children:"HTTPS Configuration"}),"\n",(0,s.jsx)(n.p,{children:"Enable HTTPS for secure communication:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"server:\n  port: 8443\n  ssl:\n    enabled: true\n    key-store: classpath:keystore.p12\n    key-store-password: ${KEYSTORE_PASSWORD}\n    key-store-type: PKCS12\n    key-alias: spring-boot-admin\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Generate keystore"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"keytool -genkeypair -alias spring-boot-admin \\\n  -keyalg RSA -keysize 2048 \\\n  -storetype PKCS12 \\\n  -keystore keystore.p12 \\\n  -validity 3650 \\\n  -storepass changeit\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Update Admin Client configuration"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"spring:\n  boot:\n    admin:\n      client:\n        url: https://admin-server:8443\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"reverse-proxy-setup",children:"Reverse Proxy Setup"}),"\n",(0,s.jsx)(n.h3,{id:"behind-nginx",children:"Behind Nginx"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Nginx Configuration"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-nginx",children:"server {\n    listen 80;\n    server_name admin.company.com;\n\n    location / {\n        proxy_pass http://localhost:8080;\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto $scheme;\n    }\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Admin Server Configuration"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"server:\n  forward-headers-strategy: native\n\nspring:\n  boot:\n    admin:\n      ui:\n        public-url: https://admin.company.com\n"})}),"\n",(0,s.jsx)(n.h3,{id:"behind-apache",children:"Behind Apache"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Apache Configuration"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-apache",children:'<VirtualHost *:80>\n    ServerName admin.company.com\n\n    ProxyPreserveHost On\n    ProxyPass / http://localhost:8080/\n    ProxyPassReverse / http://localhost:8080/\n\n    RequestHeader set X-Forwarded-Proto "https"\n    RequestHeader set X-Forwarded-Port "443"\n</VirtualHost>\n'})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"security-headers",children:"Security Headers"}),"\n",(0,s.jsx)(n.p,{children:"Add security headers to protect against common attacks:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:"@Bean\npublic SecurityFilterChain filterChain(HttpSecurity http,\n                                       AdminServerProperties adminServer) throws Exception {\n    http\n        .headers(headers -> headers\n            // Content Security Policy\n            .contentSecurityPolicy(csp -> csp\n                .policyDirectives(\"default-src 'self'; \" +\n                    \"script-src 'self' 'unsafe-inline'; \" +\n                    \"style-src 'self' 'unsafe-inline'; \" +\n                    \"img-src 'self' data:; \" +\n                    \"font-src 'self' data:\")\n            )\n            // Frame options\n            .frameOptions(frame -> frame.sameOrigin())\n            // XSS protection\n            .xssProtection(xss -> xss.headerValue(XXssProtectionHeaderWriter.HeaderValue.ENABLED_MODE_BLOCK))\n            // HSTS\n            .httpStrictTransportSecurity(hsts -> hsts\n                .includeSubDomains(true)\n                .maxAgeInSeconds(31536000)\n            )\n        );\n\n    // Other configurations...\n\n    return http.build();\n}\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"multiple-authentication-methods",children:"Multiple Authentication Methods"}),"\n",(0,s.jsx)(n.p,{children:"Support both form login and HTTP Basic:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'@Bean\npublic SecurityFilterChain filterChain(HttpSecurity http,\n                                       AdminServerProperties adminServer) throws Exception {\n    http\n        .authorizeHttpRequests(/* ... */)\n        .formLogin(formLogin -> formLogin\n            .loginPage(adminServer.path("/login"))\n        )\n        .httpBasic(Customizer.withDefaults())\n        .logout(logout -> logout\n            .logoutUrl(adminServer.path("/logout"))\n        );\n\n    return http.build();\n}\n'})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"Form login"}),": For browser-based UI access"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"HTTP Basic"}),": For API clients, scripts, monitoring tools"]}),"\n"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,s.jsx)(n.h3,{id:"issue-login-page-not-loading",children:"Issue: Login page not loading"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Cause"}),": Assets blocked by security configuration."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Solution"}),": Permit ",(0,s.jsx)(n.code,{children:"/assets/**"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'.requestMatchers(PathPatternRequestMatcher.withDefaults()\n    .matcher(adminServer.path("/assets/**")))\n.permitAll()\n'})}),"\n",(0,s.jsx)(n.h3,{id:"issue-infinite-redirect-loop",children:"Issue: Infinite redirect loop"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Cause"}),": Login page requires authentication."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Solution"}),": Permit ",(0,s.jsx)(n.code,{children:"/login"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'.requestMatchers(PathPatternRequestMatcher.withDefaults()\n    .matcher(adminServer.path("/login")))\n.permitAll()\n'})}),"\n",(0,s.jsx)(n.h3,{id:"issue-clients-cannot-register",children:"Issue: Clients cannot register"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Cause"}),": CSRF protection blocking ",(0,s.jsx)(n.code,{children:"/instances"})," endpoint."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Solution"}),": Exempt client registration endpoints:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'.csrf(csrf -> csrf\n    .ignoringRequestMatchers(\n        PathPatternRequestMatcher.withDefaults()\n            .matcher(POST, adminServer.path("/instances")),\n        PathPatternRequestMatcher.withDefaults()\n            .matcher(DELETE, adminServer.path("/instances/*"))\n    )\n)\n'})}),"\n",(0,s.jsx)(n.h3,{id:"issue-remember-me-not-working",children:"Issue: Remember-me not working"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Cause"}),": No ",(0,s.jsx)(n.code,{children:"UserDetailsService"})," configured."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Solution"}),": Add ",(0,s.jsx)(n.code,{children:"UserDetailsService"})," bean:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:"@Bean\npublic InMemoryUserDetailsManager userDetailsService(PasswordEncoder encoder) {\n    // ...\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"issue-401-on-api-requests",children:"Issue: 401 on API requests"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Cause"}),": API client not providing credentials."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Solution"}),": Use HTTP Basic authentication:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"curl -u admin:password http://localhost:8080/instances\n"})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"complete-example",children:"Complete Example"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-java",children:'package com.example.admin;\n\nimport java.util.UUID;\n\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.security.config.Customizer;\nimport org.springframework.security.config.annotation.web.builders.HttpSecurity;\nimport org.springframework.security.core.userdetails.User;\nimport org.springframework.security.core.userdetails.UserDetails;\nimport org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;\nimport org.springframework.security.crypto.password.PasswordEncoder;\nimport org.springframework.security.provisioning.InMemoryUserDetailsManager;\nimport org.springframework.security.web.SecurityFilterChain;\nimport org.springframework.security.web.authentication.SavedRequestAwareAuthenticationSuccessHandler;\nimport org.springframework.security.web.authentication.www.BasicAuthenticationFilter;\nimport org.springframework.security.web.csrf.CookieCsrfTokenRepository;\nimport org.springframework.security.web.csrf.CsrfTokenRequestAttributeHandler;\nimport org.springframework.security.web.servlet.util.matcher.PathPatternRequestMatcher;\n\nimport de.codecentric.boot.admin.server.config.AdminServerProperties;\nimport de.codecentric.boot.admin.server.config.EnableAdminServer;\n\nimport static org.springframework.http.HttpMethod.DELETE;\nimport static org.springframework.http.HttpMethod.POST;\n\n@EnableAdminServer\n@Configuration\npublic class AdminServerConfig {\n\n    private final AdminServerProperties adminServer;\n\n    public AdminServerConfig(AdminServerProperties adminServer) {\n        this.adminServer = adminServer;\n    }\n\n    @Bean\n    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {\n        SavedRequestAwareAuthenticationSuccessHandler successHandler =\n            new SavedRequestAwareAuthenticationSuccessHandler();\n        successHandler.setTargetUrlParameter("redirectTo");\n        successHandler.setDefaultTargetUrl(adminServer.path("/"));\n\n        http\n            .authorizeHttpRequests(auth -> auth\n                .requestMatchers(PathPatternRequestMatcher.withDefaults()\n                    .matcher(adminServer.path("/assets/**")))\n                .permitAll()\n                .requestMatchers(PathPatternRequestMatcher.withDefaults()\n                    .matcher(adminServer.path("/login")))\n                .permitAll()\n                .requestMatchers(PathPatternRequestMatcher.withDefaults()\n                    .matcher(adminServer.path("/actuator/info")))\n                .permitAll()\n                .requestMatchers(PathPatternRequestMatcher.withDefaults()\n                    .matcher(adminServer.path("/actuator/health")))\n                .permitAll()\n                .anyRequest().authenticated()\n            )\n            .formLogin(formLogin -> formLogin\n                .loginPage(adminServer.path("/login"))\n                .successHandler(successHandler)\n            )\n            .logout(logout -> logout\n                .logoutUrl(adminServer.path("/logout"))\n            )\n            .httpBasic(Customizer.withDefaults());\n\n        http.addFilterAfter(new CustomCsrfFilter(), BasicAuthenticationFilter.class)\n            .csrf(csrf -> csrf\n                .csrfTokenRepository(CookieCsrfTokenRepository.withHttpOnlyFalse())\n                .csrfTokenRequestHandler(new CsrfTokenRequestAttributeHandler())\n                .ignoringRequestMatchers(\n                    PathPatternRequestMatcher.withDefaults()\n                        .matcher(POST, adminServer.path("/instances")),\n                    PathPatternRequestMatcher.withDefaults()\n                        .matcher(DELETE, adminServer.path("/instances/*")),\n                    PathPatternRequestMatcher.withDefaults()\n                        .matcher(adminServer.path("/actuator/**"))\n                )\n            );\n\n        http.rememberMe(rememberMe -> rememberMe\n            .key(UUID.randomUUID().toString())\n            .tokenValiditySeconds(1209600)\n        );\n\n        return http.build();\n    }\n\n    @Bean\n    public InMemoryUserDetailsManager userDetailsService(PasswordEncoder passwordEncoder) {\n        UserDetails admin = User.builder()\n            .username("admin")\n            .password(passwordEncoder.encode(System.getenv("ADMIN_PASSWORD")))\n            .roles("ADMIN")\n            .build();\n\n        UserDetails viewer = User.builder()\n            .username("viewer")\n            .password(passwordEncoder.encode(System.getenv("VIEWER_PASSWORD")))\n            .roles("USER")\n            .build();\n\n        return new InMemoryUserDetailsManager(admin, viewer);\n    }\n\n    @Bean\n    public PasswordEncoder passwordEncoder() {\n        return new BCryptPasswordEncoder();\n    }\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"application.yml"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'spring:\n  application:\n    name: spring-boot-admin-server\n\n  boot:\n    admin:\n      context-path: /admin\n      ui:\n        title: "Production Monitor"\n\nserver:\n  port: 8443\n  ssl:\n    enabled: true\n    key-store: classpath:keystore.p12\n    key-store-password: ${KEYSTORE_PASSWORD}\n    key-store-type: PKCS12\n'})}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"see-also",children:"See Also"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/4.0.0-SNAPSHOT/docs/security/actuator-security",children:"Actuator Security"})," - Secure client actuator endpoints"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"/4.0.0-SNAPSHOT/docs/security/csrf-protection",children:"CSRF Protection"})," - Detailed CSRF configuration"]}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>a,x:()=>o});var t=r(6540);const s={},i=t.createContext(s);function a(e){const n=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);