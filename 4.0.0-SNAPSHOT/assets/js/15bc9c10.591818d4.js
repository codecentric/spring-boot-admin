"use strict";(self.webpackChunksite=self.webpackChunksite||[]).push([[2299],{8327:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>t,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"samples/sample-consul","title":"Consul Sample","description":"The Consul sample demonstrates Spring Boot Admin Server integration with HashiCorp Consul for service discovery. This","source":"@site/docs/09-samples/40-sample-consul.md","sourceDirName":"09-samples","slug":"/samples/sample-consul","permalink":"/4.0.0-SNAPSHOT/docs/samples/sample-consul","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":40,"frontMatter":{"sidebar_position":40,"sidebar_custom_props":{"icon":"file-code"}},"sidebar":"sidebar","previous":{"title":"Eureka Sample","permalink":"/4.0.0-SNAPSHOT/docs/samples/sample-eureka"},"next":{"title":"Zookeeper Sample","permalink":"/4.0.0-SNAPSHOT/docs/samples/sample-zookeeper"}}');var l=s(4848),r=s(8453);const t={sidebar_position:40,sidebar_custom_props:{icon:"file-code"}},a="Consul Sample",c={},o=[{value:"Overview",id:"overview",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Installing Consul",id:"installing-consul",level:2},{value:"macOS",id:"macos",level:3},{value:"Linux",id:"linux",level:3},{value:"Windows",id:"windows",level:3},{value:"Docker",id:"docker",level:3},{value:"Verify Installation",id:"verify-installation",level:3},{value:"Running the Sample",id:"running-the-sample",level:2},{value:"Start Consul",id:"start-consul",level:3},{value:"Start Admin Server",id:"start-admin-server",level:3},{value:"With Different Consul Host",id:"with-different-consul-host",level:3},{value:"Insecure Mode",id:"insecure-mode",level:3},{value:"Project Structure",id:"project-structure",level:2},{value:"Dependencies",id:"dependencies",level:3},{value:"Main Application Class",id:"main-application-class",level:3},{value:"Configuration",id:"configuration",level:2},{value:"Admin Server Configuration",id:"admin-server-configuration",level:3},{value:"Client Application Configuration",id:"client-application-configuration",level:3},{value:"Security Configuration",id:"security-configuration",level:2},{value:"Insecure Profile",id:"insecure-profile",level:3},{value:"Secure Profile (Default)",id:"secure-profile-default",level:3},{value:"How It Works",id:"how-it-works",level:2},{value:"Service Discovery Flow",id:"service-discovery-flow",level:3},{value:"Metadata Mapping",id:"metadata-mapping",level:3},{value:"Custom Actuator Paths",id:"custom-actuator-paths",level:2},{value:"Testing the Sample",id:"testing-the-sample",level:2},{value:"Verify Consul Registration",id:"verify-consul-registration",level:3},{value:"Check Service Health",id:"check-service-health",level:3},{value:"Verify Admin Discovery",id:"verify-admin-discovery",level:3},{value:"Test Dynamic Discovery",id:"test-dynamic-discovery",level:3},{value:"Consul Features",id:"consul-features",level:2},{value:"Health Checks",id:"health-checks",level:3},{value:"HTTP Health Check",id:"http-health-check",level:4},{value:"TTL Health Check",id:"ttl-health-check",level:4},{value:"Service Tags",id:"service-tags",level:3},{value:"Service Filtering",id:"service-filtering",level:3},{value:"Advanced Configuration",id:"advanced-configuration",level:2},{value:"Consul ACL",id:"consul-acl",level:3},{value:"Consul TLS",id:"consul-tls",level:3},{value:"Multiple Datacenters",id:"multiple-datacenters",level:3},{value:"Prefer IP Address",id:"prefer-ip-address",level:3},{value:"Comparison: Consul vs. Eureka",id:"comparison-consul-vs-eureka",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Metadata Key Errors",id:"metadata-key-errors",level:3},{value:"Services Not Discovered",id:"services-not-discovered",level:3},{value:"Health Check Failures",id:"health-check-failures",level:3},{value:"Connection Timeouts",id:"connection-timeouts",level:3},{value:"Production Considerations",id:"production-considerations",level:2},{value:"Consul Cluster",id:"consul-cluster",level:3},{value:"Enable ACL",id:"enable-acl",level:3},{value:"Monitor Consul Health",id:"monitor-consul-health",level:3},{value:"Key Takeaways",id:"key-takeaways",level:2},{value:"Next Steps",id:"next-steps",level:2},{value:"See Also",id:"see-also",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"consul-sample",children:"Consul Sample"})}),"\n",(0,l.jsx)(n.p,{children:"The Consul sample demonstrates Spring Boot Admin Server integration with HashiCorp Consul for service discovery. This\nsample shows how to leverage Consul's powerful service registry and health checking capabilities to automatically\ndiscover and monitor Spring Boot applications."}),"\n",(0,l.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Location"}),": ",(0,l.jsx)(n.code,{children:"spring-boot-admin-samples/spring-boot-admin-sample-consul/"})]}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Features"}),":"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Automatic service discovery via Consul"}),"\n",(0,l.jsx)(n.li,{children:"No Admin Client required on monitored applications"}),"\n",(0,l.jsx)(n.li,{children:"Consul health check integration"}),"\n",(0,l.jsx)(n.li,{children:"Metadata-based configuration"}),"\n",(0,l.jsx)(n.li,{children:"Custom actuator endpoint paths"}),"\n",(0,l.jsx)(n.li,{children:"Spring Security integration"}),"\n",(0,l.jsx)(n.li,{children:"Servlet-based deployment"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Java 17 or higher"}),"\n",(0,l.jsx)(n.li,{children:"Maven 3.6+"}),"\n",(0,l.jsx)(n.li,{children:"Consul installed and running"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"installing-consul",children:"Installing Consul"}),"\n",(0,l.jsx)(n.h3,{id:"macos",children:"macOS"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"brew install consul\n"})}),"\n",(0,l.jsx)(n.h3,{id:"linux",children:"Linux"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"wget https://releases.hashicorp.com/consul/1.17.0/consul_1.17.0_linux_amd64.zip\nunzip consul_1.17.0_linux_amd64.zip\nsudo mv consul /usr/local/bin/\n"})}),"\n",(0,l.jsx)(n.h3,{id:"windows",children:"Windows"}),"\n",(0,l.jsxs)(n.p,{children:["Download from: ",(0,l.jsx)(n.a,{href:"https://www.consul.io/downloads",children:"https://www.consul.io/downloads"})]}),"\n",(0,l.jsx)(n.h3,{id:"docker",children:"Docker"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"docker run -d -p 8500:8500 -p 8600:8600/udp --name=consul consul agent -server -ui -bootstrap-expect=1 -client=0.0.0.0\n"})}),"\n",(0,l.jsx)(n.h3,{id:"verify-installation",children:"Verify Installation"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"consul version\n"})}),"\n",(0,l.jsx)(n.h2,{id:"running-the-sample",children:"Running the Sample"}),"\n",(0,l.jsx)(n.h3,{id:"start-consul",children:"Start Consul"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# Development mode (single node)\nconsul agent -dev\n"})}),"\n",(0,l.jsxs)(n.p,{children:["Verify Consul is running: ",(0,l.jsx)(n.code,{children:"http://localhost:8500/ui"})]}),"\n",(0,l.jsx)(n.h3,{id:"start-admin-server",children:"Start Admin Server"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"cd spring-boot-admin-samples/spring-boot-admin-sample-consul\nmvn spring-boot:run\n"})}),"\n",(0,l.jsxs)(n.p,{children:["Access Admin UI at: ",(0,l.jsx)(n.code,{children:"http://localhost:8080"})]}),"\n",(0,l.jsx)(n.h3,{id:"with-different-consul-host",children:"With Different Consul Host"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"mvn spring-boot:run -Dspring-boot.run.arguments=\\\n  --spring.cloud.consul.host=consul-server\n"})}),"\n",(0,l.jsx)(n.h3,{id:"insecure-mode",children:"Insecure Mode"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"mvn spring-boot:run -Dspring-boot.run.profiles=insecure\n"})}),"\n",(0,l.jsx)(n.h2,{id:"project-structure",children:"Project Structure"}),"\n",(0,l.jsx)(n.h3,{id:"dependencies",children:"Dependencies"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-xml",children:"<dependencies>\n    \x3c!-- Admin Server --\x3e\n    <dependency>\n        <groupId>de.codecentric</groupId>\n        <artifactId>spring-boot-admin-starter-server</artifactId>\n    </dependency>\n\n    \x3c!-- Consul Discovery --\x3e\n    <dependency>\n        <groupId>org.springframework.cloud</groupId>\n        <artifactId>spring-cloud-starter-consul-discovery</artifactId>\n    </dependency>\n\n    \x3c!-- Web (Servlet) --\x3e\n    <dependency>\n        <groupId>org.springframework.boot</groupId>\n        <artifactId>spring-boot-starter-webmvc</artifactId>\n    </dependency>\n\n    \x3c!-- Security --\x3e\n    <dependency>\n        <groupId>org.springframework.boot</groupId>\n        <artifactId>spring-boot-starter-security</artifactId>\n    </dependency>\n</dependencies>\n"})}),"\n",(0,l.jsx)(n.h3,{id:"main-application-class",children:"Main Application Class"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-java",metastring:'title="SpringBootAdminConsulApplication.java"',children:"@SpringBootApplication\n@EnableDiscoveryClient  // Enable Consul discovery\n@EnableAdminServer      // Enable Admin Server\npublic class SpringBootAdminConsulApplication {\n\n    static void main(String[] args) {\n        SpringApplication.run(SpringBootAdminConsulApplication.class, args);\n    }\n}\n"})}),"\n",(0,l.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,l.jsx)(n.h3,{id:"admin-server-configuration",children:"Admin Server Configuration"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",metastring:'title="application.yml"',children:'spring:\n  application:\n    name: consul-example\n\n  cloud:\n    config:\n      enabled: false  # Disable config client\n    consul:\n      host: localhost\n      port: 8500\n      discovery:\n        metadata:\n          # IMPORTANT: Use dashes, not dots in metadata keys!\n          management-context-path: /foo\n          health-path: /ping\n          user-name: user\n          user-password: password\n\n  profiles:\n    active:\n      - secure\n\n  boot:\n    admin:\n      discovery:\n        ignored-services: consul  # Don\'t monitor Consul itself\n\nmanagement:\n  endpoints:\n    web:\n      exposure:\n        include: "*"\n      base-path: /foo  # Custom actuator base path\n      path-mapping:\n        health: /ping  # Custom health endpoint path\n  endpoint:\n    health:\n      show-details: ALWAYS\n'})}),"\n",(0,l.jsxs)(n.admonition,{title:"Metadata Key Restriction",type:"warning",children:[(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"CRITICAL"}),": Consul metadata keys ",(0,l.jsx)(n.strong,{children:"cannot contain dots"}),". Use dashes instead:"]}),(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u2705 ",(0,l.jsx)(n.code,{children:"management-context-path"})]}),"\n",(0,l.jsxs)(n.li,{children:["\u274c ",(0,l.jsx)(n.code,{children:"management.context-path"})]}),"\n"]}),(0,l.jsx)(n.p,{children:"This is a Consul limitation, not a Spring Boot Admin limitation."})]}),"\n",(0,l.jsx)(n.h3,{id:"client-application-configuration",children:"Client Application Configuration"}),"\n",(0,l.jsx)(n.p,{children:"For applications to be monitored:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:'spring:\n  application:\n    name: my-service\n\n  cloud:\n    consul:\n      host: localhost\n      port: 8500\n      discovery:\n        metadata:\n          management-context-path: /actuator  # Use dashes!\n          health-path: /actuator/health\n          # For secured actuators\n          user-name: ${actuator.username}\n          user-password: ${actuator.password}\n\nmanagement:\n  endpoints:\n    web:\n      exposure:\n        include: "*"\n'})}),"\n",(0,l.jsx)(n.h2,{id:"security-configuration",children:"Security Configuration"}),"\n",(0,l.jsx)(n.h3,{id:"insecure-profile",children:"Insecure Profile"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-java",children:'@Profile("insecure")\n@Configuration\npublic static class SecurityPermitAllConfig {\n\n    @Bean\n    protected SecurityFilterChain filterChain(HttpSecurity http)\n            throws Exception {\n        http.authorizeHttpRequests((authorizeRequests) ->\n                authorizeRequests.anyRequest().permitAll())\n            .csrf((csrf) -> csrf\n                .csrfTokenRepository(CookieCsrfTokenRepository.withHttpOnlyFalse())\n                .ignoringRequestMatchers(\n                    adminContextPath + "/instances",\n                    adminContextPath + "/instances/*",\n                    adminContextPath + "/actuator/**"\n                ));\n        return http.build();\n    }\n}\n'})}),"\n",(0,l.jsx)(n.h3,{id:"secure-profile-default",children:"Secure Profile (Default)"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-java",children:'@Profile("secure")\n@Configuration\npublic static class SecuritySecureConfig {\n\n    @Bean\n    protected SecurityFilterChain filterChain(HttpSecurity http)\n            throws Exception {\n        SavedRequestAwareAuthenticationSuccessHandler successHandler =\n            new SavedRequestAwareAuthenticationSuccessHandler();\n        successHandler.setTargetUrlParameter("redirectTo");\n        successHandler.setDefaultTargetUrl(adminContextPath + "/");\n\n        http.authorizeHttpRequests((authorizeRequests) ->\n                authorizeRequests\n                    .requestMatchers(adminContextPath + "/assets/**")\n                        .permitAll()\n                    .requestMatchers(adminContextPath + "/login")\n                        .permitAll()\n                    .anyRequest()\n                        .authenticated())\n            .formLogin((formLogin) -> formLogin\n                .loginPage(adminContextPath + "/login")\n                .successHandler(successHandler))\n            .logout((logout) -> logout\n                .logoutUrl(adminContextPath + "/logout"))\n            .httpBasic(Customizer.withDefaults())\n            .csrf((csrf) -> csrf\n                .csrfTokenRepository(CookieCsrfTokenRepository.withHttpOnlyFalse())\n                .ignoringRequestMatchers(\n                    adminContextPath + "/instances",\n                    adminContextPath + "/instances/*",\n                    adminContextPath + "/actuator/**"\n                ));\n\n        return http.build();\n    }\n}\n'})}),"\n",(0,l.jsx)(n.h2,{id:"how-it-works",children:"How It Works"}),"\n",(0,l.jsx)(n.h3,{id:"service-discovery-flow",children:"Service Discovery Flow"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Application Registration"}),":"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Application registers with Consul on startup"}),"\n",(0,l.jsx)(n.li,{children:"Sends service metadata including actuator paths"}),"\n",(0,l.jsx)(n.li,{children:"Consul assigns service ID and health checks"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Health Checking"}),":"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Consul performs HTTP health checks"}),"\n",(0,l.jsx)(n.li,{children:"Marks services as passing/failing"}),"\n",(0,l.jsx)(n.li,{children:"Admin Server queries only healthy services"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Admin Discovery"}),":"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Admin Server queries Consul for registered services"}),"\n",(0,l.jsx)(n.li,{children:"Reads metadata to locate actuator endpoints"}),"\n",(0,l.jsx)(n.li,{children:"Begins monitoring discovered services"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Deregistration"}),":"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Application deregisters on shutdown"}),"\n",(0,l.jsx)(n.li,{children:"Consul removes from registry"}),"\n",(0,l.jsx)(n.li,{children:"Admin Server stops monitoring"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"metadata-mapping",children:"Metadata Mapping"}),"\n",(0,l.jsx)(n.p,{children:"Admin Server reads specific metadata keys from Consul:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:"spring:\n  cloud:\n    consul:\n      discovery:\n        metadata:\n          # Required for endpoint detection\n          management-context-path: /actuator  # Dashes only!\n          management-port: 8081  # If different\n\n          # Optional - for secured actuators\n          user-name: admin\n          user-password: ${ACTUATOR_PASSWORD}\n\n          # Custom metadata\n          environment: production\n          version: 1.0.0\n          team: platform\n"})}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Key Mappings"}),":"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"management-context-path"})," \u2192 Where to find actuator endpoints"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"management-port"})," \u2192 Management port if different from service port"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"health-path"})," \u2192 Custom health endpoint path"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"user-name"})," / ",(0,l.jsx)(n.code,{children:"user-password"})," \u2192 Actuator credentials"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"custom-actuator-paths",children:"Custom Actuator Paths"}),"\n",(0,l.jsx)(n.p,{children:"This sample demonstrates custom actuator paths:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:"management:\n  endpoints:\n    web:\n      base-path: /foo          # Actuator at /foo instead of /actuator\n      path-mapping:\n        health: /ping          # Health at /foo/ping instead of /foo/health\n"})}),"\n",(0,l.jsx)(n.p,{children:"Admin Server discovers these via metadata:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:"spring:\n  cloud:\n    consul:\n      discovery:\n        metadata:\n          management-context-path: /foo\n          health-path: /ping\n"})}),"\n",(0,l.jsx)(n.h2,{id:"testing-the-sample",children:"Testing the Sample"}),"\n",(0,l.jsx)(n.h3,{id:"verify-consul-registration",children:"Verify Consul Registration"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["Access Consul UI: ",(0,l.jsx)(n.code,{children:"http://localhost:8500/ui"})]}),"\n",(0,l.jsx)(n.li,{children:'Navigate to "Services"'}),"\n",(0,l.jsxs)(n.li,{children:["Should see:","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"consul-example"})," (Admin Server)"]}),"\n",(0,l.jsx)(n.li,{children:"Other registered services"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"check-service-health",children:"Check Service Health"}),"\n",(0,l.jsx)(n.p,{children:"In Consul UI, services should show:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Status: Passing (green)"}),"\n",(0,l.jsx)(n.li,{children:"Health check URL displayed"}),"\n",(0,l.jsx)(n.li,{children:"Metadata visible"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"verify-admin-discovery",children:"Verify Admin Discovery"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["Access Admin UI: ",(0,l.jsx)(n.code,{children:"http://localhost:8080"})]}),"\n",(0,l.jsx)(n.li,{children:"Should see services registered in Consul"}),"\n",(0,l.jsxs)(n.li,{children:["Click service to view:","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Health status"}),"\n",(0,l.jsx)(n.li,{children:"Metrics"}),"\n",(0,l.jsx)(n.li,{children:"Environment"}),"\n",(0,l.jsx)(n.li,{children:"Custom /ping endpoint"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"test-dynamic-discovery",children:"Test Dynamic Discovery"}),"\n",(0,l.jsx)(n.p,{children:"Register a new service:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'# Register via Consul API\ncurl -X PUT -d \'{\n  "Name": "test-service",\n  "Address": "127.0.0.1",\n  "Port": 8081,\n  "Meta": {\n    "management-context-path": "/actuator"\n  },\n  "Check": {\n    "HTTP": "http://127.0.0.1:8081/actuator/health",\n    "Interval": "10s"\n  }\n}\' http://localhost:8500/v1/agent/service/register\n'})}),"\n",(0,l.jsx)(n.p,{children:"Service appears in Admin UI within seconds."}),"\n",(0,l.jsx)(n.h2,{id:"consul-features",children:"Consul Features"}),"\n",(0,l.jsx)(n.h3,{id:"health-checks",children:"Health Checks"}),"\n",(0,l.jsx)(n.p,{children:"Consul supports multiple health check types:"}),"\n",(0,l.jsx)(n.h4,{id:"http-health-check",children:"HTTP Health Check"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:"spring:\n  cloud:\n    consul:\n      discovery:\n        health-check-path: /actuator/health\n        health-check-interval: 10s\n        health-check-timeout: 5s\n"})}),"\n",(0,l.jsx)(n.h4,{id:"ttl-health-check",children:"TTL Health Check"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:"spring:\n  cloud:\n    consul:\n      discovery:\n        health-check-ttl: 30s\n"})}),"\n",(0,l.jsx)(n.p,{children:"Application must send heartbeat to Consul every 30 seconds."}),"\n",(0,l.jsx)(n.h3,{id:"service-tags",children:"Service Tags"}),"\n",(0,l.jsx)(n.p,{children:"Add tags for filtering:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:"spring:\n  cloud:\n    consul:\n      discovery:\n        tags:\n          - production\n          - backend\n          - v1.0.0\n"})}),"\n",(0,l.jsx)(n.h3,{id:"service-filtering",children:"Service Filtering"}),"\n",(0,l.jsx)(n.p,{children:"Filter services monitored by Admin:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:"spring:\n  boot:\n    admin:\n      discovery:\n        ignored-services:\n          - consul        # Don't monitor Consul\n          - config-server # Don't monitor Config Server\n        services:         # Only monitor these (if specified)\n          - my-service\n          - another-service\n"})}),"\n",(0,l.jsx)(n.h2,{id:"advanced-configuration",children:"Advanced Configuration"}),"\n",(0,l.jsx)(n.h3,{id:"consul-acl",children:"Consul ACL"}),"\n",(0,l.jsx)(n.p,{children:"Secure Consul with ACL tokens:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:"spring:\n  cloud:\n    consul:\n      token: ${CONSUL_TOKEN}\n      discovery:\n        acl-token: ${CONSUL_ACL_TOKEN}\n"})}),"\n",(0,l.jsx)(n.h3,{id:"consul-tls",children:"Consul TLS"}),"\n",(0,l.jsx)(n.p,{children:"Connect to Consul over TLS:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:"spring:\n  cloud:\n    consul:\n      scheme: https\n      tls:\n        enabled: true\n        key-store-path: classpath:consul-keystore.p12\n        key-store-password: ${KEYSTORE_PASSWORD}\n"})}),"\n",(0,l.jsx)(n.h3,{id:"multiple-datacenters",children:"Multiple Datacenters"}),"\n",(0,l.jsx)(n.p,{children:"Register in specific datacenter:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:"spring:\n  cloud:\n    consul:\n      discovery:\n        datacenter: dc1\n"})}),"\n",(0,l.jsx)(n.h3,{id:"prefer-ip-address",children:"Prefer IP Address"}),"\n",(0,l.jsx)(n.p,{children:"Use IP instead of hostname:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:"spring:\n  cloud:\n    consul:\n      discovery:\n        prefer-ip-address: true\n        ip-address: 192.168.1.100\n"})}),"\n",(0,l.jsx)(n.h2,{id:"comparison-consul-vs-eureka",children:"Comparison: Consul vs. Eureka"}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"Feature"}),(0,l.jsx)(n.th,{children:"Consul"}),(0,l.jsx)(n.th,{children:"Eureka"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.strong,{children:"Health Checks"})}),(0,l.jsx)(n.td,{children:"Built-in (HTTP, TCP, TTL, Script)"}),(0,l.jsx)(n.td,{children:"Via Spring Boot actuator only"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.strong,{children:"Key-Value Store"})}),(0,l.jsx)(n.td,{children:"Yes"}),(0,l.jsx)(n.td,{children:"No"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.strong,{children:"ACL"})}),(0,l.jsx)(n.td,{children:"Yes"}),(0,l.jsx)(n.td,{children:"Basic"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.strong,{children:"Multi-DC"})}),(0,l.jsx)(n.td,{children:"Native support"}),(0,l.jsx)(n.td,{children:"Requires setup"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.strong,{children:"DNS Interface"})}),(0,l.jsx)(n.td,{children:"Yes"}),(0,l.jsx)(n.td,{children:"No"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.strong,{children:"Metadata Keys"})}),(0,l.jsx)(n.td,{children:"No dots allowed"}),(0,l.jsx)(n.td,{children:"Dots allowed"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.strong,{children:"Complexity"})}),(0,l.jsx)(n.td,{children:"Higher"}),(0,l.jsx)(n.td,{children:"Lower"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.strong,{children:"Ecosystem"})}),(0,l.jsx)(n.td,{children:"HashiCorp ecosystem"}),(0,l.jsx)(n.td,{children:"Netflix stack"})]})]})]}),"\n",(0,l.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,l.jsx)(n.h3,{id:"metadata-key-errors",children:"Metadata Key Errors"}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Symptom"}),": Admin Server can't find actuator endpoints"]}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Cause"}),": Used dots in metadata keys"]}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Solution"}),": Use dashes instead:"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:"# Wrong\nmetadata:\n  management.context-path: /actuator\n\n# Correct\nmetadata:\n  management-context-path: /actuator\n"})}),"\n",(0,l.jsx)(n.h3,{id:"services-not-discovered",children:"Services Not Discovered"}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Check Consul connectivity"}),":"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# Test Consul API\ncurl http://localhost:8500/v1/catalog/services\n\n# Check health\ncurl http://localhost:8500/v1/health/state/passing\n"})}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.strong,{children:"Verify Admin logs"}),":"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"tail -f logs/spring-boot-admin.log | grep -i consul\n"})}),"\n",(0,l.jsx)(n.h3,{id:"health-check-failures",children:"Health Check Failures"}),"\n",(0,l.jsx)(n.p,{children:'Services show as "failing" in Consul:'}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Verify health endpoint is accessible:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"curl http://localhost:8080/actuator/health\n"})}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Check health check interval:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:"spring:\n  cloud:\n    consul:\n      discovery:\n        health-check-interval: 30s  # Increase if needed\n"})}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsx)(n.p,{children:"Review Consul logs:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"consul monitor\n"})}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"connection-timeouts",children:"Connection Timeouts"}),"\n",(0,l.jsx)(n.p,{children:"Increase timeout values:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:"spring:\n  cloud:\n    consul:\n      discovery:\n        health-check-timeout: 10s  # Increase from default\n"})}),"\n",(0,l.jsx)(n.h2,{id:"production-considerations",children:"Production Considerations"}),"\n",(0,l.jsx)(n.h3,{id:"consul-cluster",children:"Consul Cluster"}),"\n",(0,l.jsx)(n.p,{children:"Run Consul in cluster mode (3 or 5 nodes):"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# Server node 1\nconsul agent -server -bootstrap-expect=3 -data-dir=/consul/data \\\n  -bind=192.168.1.10\n\n# Server node 2\nconsul agent -server -data-dir=/consul/data \\\n  -bind=192.168.1.11 -join=192.168.1.10\n\n# Server node 3\nconsul agent -server -data-dir=/consul/data \\\n  -bind=192.168.1.12 -join=192.168.1.10\n"})}),"\n",(0,l.jsx)(n.h3,{id:"enable-acl",children:"Enable ACL"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:"spring:\n  cloud:\n    consul:\n      token: ${CONSUL_MANAGEMENT_TOKEN}\n      discovery:\n        acl-token: ${CONSUL_SERVICE_TOKEN}\n"})}),"\n",(0,l.jsx)(n.h3,{id:"monitor-consul-health",children:"Monitor Consul Health"}),"\n",(0,l.jsx)(n.p,{children:"Register Admin Server to monitor itself:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:"spring:\n  boot:\n    admin:\n      discovery:\n        ignored-services: []  # Don't ignore any services\n"})}),"\n",(0,l.jsx)(n.h2,{id:"key-takeaways",children:"Key Takeaways"}),"\n",(0,l.jsx)(n.p,{children:"This sample demonstrates:"}),"\n",(0,l.jsxs)(n.p,{children:["\u2705 ",(0,l.jsx)(n.strong,{children:"Consul Integration"})]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Service discovery via Consul"}),"\n",(0,l.jsx)(n.li,{children:"Health check integration"}),"\n"]}),"\n",(0,l.jsxs)(n.p,{children:["\u2705 ",(0,l.jsx)(n.strong,{children:"Metadata Handling"})]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Proper metadata key formatting (dashes not dots)"}),"\n",(0,l.jsx)(n.li,{children:"Custom actuator paths"}),"\n"]}),"\n",(0,l.jsxs)(n.p,{children:["\u2705 ",(0,l.jsx)(n.strong,{children:"Production Features"})]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"ACL support"}),"\n",(0,l.jsx)(n.li,{children:"TLS encryption"}),"\n",(0,l.jsx)(n.li,{children:"Multi-datacenter awareness"}),"\n"]}),"\n",(0,l.jsxs)(n.p,{children:["\u2705 ",(0,l.jsx)(n.strong,{children:"Flexibility"})]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Custom endpoint paths"}),"\n",(0,l.jsx)(n.li,{children:"Secure and insecure modes"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Explore ",(0,l.jsx)(n.a,{href:"/4.0.0-SNAPSHOT/docs/samples/sample-eureka",children:"Eureka Sample"})," for Netflix Eureka"]}),"\n",(0,l.jsxs)(n.li,{children:["Review ",(0,l.jsx)(n.a,{href:"/4.0.0-SNAPSHOT/docs/samples/sample-zookeeper",children:"Zookeeper Sample"})," for Apache Zookeeper"]}),"\n",(0,l.jsxs)(n.li,{children:["Check ",(0,l.jsx)(n.a,{href:"/4.0.0-SNAPSHOT/docs/integration/consul",children:"Consul Integration Guide"})," for detailed setup"]}),"\n",(0,l.jsxs)(n.li,{children:["See ",(0,l.jsx)(n.a,{href:"/4.0.0-SNAPSHOT/docs/samples/sample-hazelcast",children:"Hazelcast Sample"})," for clustering"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"see-also",children:"See Also"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"/4.0.0-SNAPSHOT/docs/integration/consul",children:"Consul Integration Guide"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"/4.0.0-SNAPSHOT/docs/client/service-discovery",children:"Service Discovery"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"/4.0.0-SNAPSHOT/docs/server/server",children:"Server Configuration"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://www.consul.io/docs",children:"HashiCorp Consul Documentation"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(d,{...e})}):d(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>t,x:()=>a});var i=s(6540);const l={},r=i.createContext(l);function t(e){const n=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:t(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);